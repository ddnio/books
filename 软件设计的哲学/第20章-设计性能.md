# ç¬¬20ç«  è®¾è®¡æ€§èƒ½ ğŸš€
*Chapter 20 Designing for Performance*

## ğŸï¸ å¼€ç¯‡æ•…äº‹ï¼šé€Ÿåº¦ä¸ç¾çš„å®Œç¾å¹³è¡¡

æƒ³è±¡ä¸€ä¸‹ä¸€ä½èµ›è½¦è®¾è®¡å¸ˆçš„å›°å¢ƒï¼š
- ğŸ å®¢æˆ·è¦æ±‚ï¼šè½¦å­å¿…é¡»è·‘å¾—é£å¿«ï¼Œåœ¨èµ›é“ä¸Šç§°éœ¸
- ğŸ¨ è®¾è®¡å¸ˆçš„è¿½æ±‚ï¼šè½¦å­è¿˜è¦ç¾è§‚ã€ç®€æ´ã€æ˜“äºç»´æŠ¤
- ğŸ’­ å¸¸è§çš„è¯¯è§£ï¼šè®¤ä¸ºé€Ÿåº¦å’Œç¾è§‚æ˜¯çŸ›ç›¾çš„ï¼Œè¦å¿«å°±å¾—ç‰ºç‰²è®¾è®¡

**è®¸å¤šç¨‹åºå‘˜ä¹Ÿé¢ä¸´åŒæ ·çš„å›°å¢ƒ**ï¼šæ˜¯å¦ä¸ºäº†æ€§èƒ½è€Œç‰ºç‰²ä»£ç çš„ç®€æ´æ€§ï¼Ÿ

ä½†æ˜¯ï¼Œå°±åƒæœ€å¥½çš„èµ›è½¦æ—¢å¿«é€Ÿåˆä¼˜é›…ä¸€æ ·ï¼Œ**æœ€å¥½çš„è½¯ä»¶ä¹Ÿèƒ½åœ¨é«˜æ€§èƒ½å’Œç®€æ´è®¾è®¡ä¹‹é—´æ‰¾åˆ°å®Œç¾å¹³è¡¡**ã€‚

> **æœ¬ç« çš„æ ¸å¿ƒè§‚ç‚¹**ï¼šç®€æ´æ€§ä¸ä»…èƒ½æ”¹å–„ç³»ç»Ÿè®¾è®¡ï¼Œé€šå¸¸è¿˜èƒ½è®©ç³»ç»Ÿè¿è¡Œå¾—æ›´å¿«ï¼

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä¸€ç›´ä¸“æ³¨äºé™ä½è½¯ä»¶å¤æ‚æ€§ï¼Œè®©è½¯ä»¶å°½å¯èƒ½ç®€å•æ˜“æ‡‚ã€‚ä½†å¦‚æœä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦é«˜æ€§èƒ½çš„ç³»ç»Ÿå‘¢ï¼Ÿæ€§èƒ½è€ƒè™‘åº”è¯¥å¦‚ä½•å½±å“è®¾è®¡è¿‡ç¨‹ï¼Ÿ

**æœ¬ç« å°†å‘Šè¯‰ä½ **ï¼š
- å¦‚ä½•åœ¨ä¸ç‰ºç‰²ç®€æ´è®¾è®¡çš„æƒ…å†µä¸‹å®ç°é«˜æ€§èƒ½
- ä¸ºä»€ä¹ˆç®€å•çš„ä»£ç å¾€å¾€æ¯”å¤æ‚çš„ä»£ç è·‘å¾—æ›´å¿«
- å¦‚ä½•ç”¨æ­£ç¡®çš„æ–¹æ³•è¿›è¡Œæ€§èƒ½ä¼˜åŒ–

---

## 20.1 å¦‚ä½•æ€è€ƒæ€§èƒ½é—®é¢˜ ğŸ¤”
*How to think about performance*

### ğŸ¯ å¼€å‘è¿‡ç¨‹ä¸­çš„æ€§èƒ½å›°å¢ƒ

åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œä½ åº”è¯¥åœ¨å¤šå¤§ç¨‹åº¦ä¸Šæ‹…å¿ƒæ€§èƒ½ï¼Ÿè¿™æ˜¯ä¸€ä¸ªç»å…¸çš„å¹³è¡¡é—®é¢˜ï¼š

**ğŸ”´ æç«¯æ–¹æ¡ˆAï¼šè¿‡åº¦ä¼˜åŒ–**
```java
// ä¸ºäº†æ€§èƒ½ï¼Œä»£ç å˜å¾—éš¾ä»¥ç†è§£
public class OverOptimizedCode {
    // æ‰‹åŠ¨å†…è”æ‰€æœ‰æ–¹æ³•è°ƒç”¨
    public void processData(int[] data) {
        int len = data.length;
        int sum = 0;
        for (int i = 0; i < len; ++i) {  // ç”¨++iè€Œä¸æ˜¯i++
            int val = data[i];
            if (val > 0) {
                sum += val;
            } else if (val < 0) {
                sum -= val;  // æ‰‹åŠ¨ç»å¯¹å€¼è®¡ç®—
            }
        }
        // æ›´å¤šéš¾ä»¥ç†è§£çš„ä¼˜åŒ–...
    }
}
```

**é—®é¢˜**ï¼š
- å¼€å‘é€Ÿåº¦å˜æ…¢
- äº§ç”Ÿå¤§é‡ä¸å¿…è¦çš„å¤æ‚æ€§
- è®¸å¤š"ä¼˜åŒ–"å®é™…ä¸Šå¯¹æ€§èƒ½æ²¡æœ‰å¸®åŠ©

**ğŸ”´ æç«¯æ–¹æ¡ˆBï¼šå®Œå…¨å¿½ç•¥æ€§èƒ½**
```java
// å®Œå…¨ä¸è€ƒè™‘æ€§èƒ½
public class SlowCode {
    public List<String> processUsers(List<User> users) {
        List<String> result = new ArrayList<>();
        for (User user : users) {
            // æ¯æ¬¡éƒ½é‡æ–°è¿æ¥æ•°æ®åº“
            Connection conn = DriverManager.getConnection(DB_URL);
            // æ¯æ¬¡éƒ½é‡æ–°ç¼–è¯‘SQL
            String sql = "SELECT * FROM profiles WHERE user_id = " + user.getId();
            // æ²¡æœ‰ç¼“å­˜ï¼Œé‡å¤è®¡ç®—
            String profile = expensiveCalculation(user);
            result.add(profile);
            conn.close();
        }
        return result;
    }
}
```

**é—®é¢˜**ï¼š
- ç³»ç»Ÿå®¹æ˜“æ¯”éœ€è¦çš„é€Ÿåº¦æ…¢5-10å€
- "åƒåˆ€ä¸‡å‰"çš„æ€§èƒ½é—®é¢˜éå¸ƒä»£ç 
- åæœŸå¾ˆéš¾å›æ¥ä¼˜åŒ–ï¼Œå› ä¸ºæ²¡æœ‰å•ä¸€çš„æ”¹è¿›ç‚¹èƒ½äº§ç”Ÿæ˜¾è‘—å½±å“

### âœ… æœ€ä½³å¹³è¡¡ï¼šè‡ªç„¶é«˜æ•ˆçš„è®¾è®¡

**æœ€å¥½çš„æ–¹æ³•**æ˜¯åœ¨ä¸¤ä¸ªæç«¯ä¹‹é—´æ‰¾åˆ°å¹³è¡¡ï¼š

> ä½¿ç”¨æ€§èƒ½çš„åŸºæœ¬çŸ¥è¯†æ¥é€‰æ‹©**"è‡ªç„¶é«˜æ•ˆ"**ä½†åˆå¹²å‡€ç®€å•çš„è®¾è®¡æ–¹æ¡ˆã€‚

**æ ¸å¿ƒç­–ç•¥**ï¼šåŸ¹å…»å¯¹**åŸºæœ¬æ˜‚è´µæ“ä½œ**çš„æ•æ„Ÿåº¦

### ğŸ’° æ˜‚è´µæ“ä½œçš„æˆæœ¬æ¸…å•

äº†è§£å“ªäº›æ“ä½œç›¸å¯¹æ˜‚è´µï¼Œæ˜¯åšå‡ºæ˜æ™ºè®¾è®¡å†³ç­–çš„å…³é”®ï¼š

| æ“ä½œç±»å‹ | å…¸å‹è€—æ—¶ | ç›¸å½“äºæŒ‡ä»¤æ•° | å½±å“ |
|---|---|---|---|
| **ç½‘ç»œé€šä¿¡** | 10-50Î¼s (æ•°æ®ä¸­å¿ƒå†…) | æ•°ä¸‡æ¡æŒ‡ä»¤ | ğŸ”´ æé«˜ |
| **å¹¿åŸŸç½‘é€šä¿¡** | 10-100ms | æ•°åƒä¸‡æ¡æŒ‡ä»¤ | ğŸ”´ æé«˜ |
| **ç£ç›˜I/O** | 5-10ms | æ•°ç™¾ä¸‡æ¡æŒ‡ä»¤ | ğŸ”´ æé«˜ |
| **SSDå­˜å‚¨** | 10-100Î¼s | æ•°ä¸‡æ¡æŒ‡ä»¤ | ğŸŸ¡ é«˜ |
| **å†…å­˜åˆ†é…** | å˜åŒ–å¾ˆå¤§ | æ•°ç™¾åˆ°æ•°åƒæ¡æŒ‡ä»¤ | ğŸŸ¡ ä¸­ç­‰ |
| **ç¼“å­˜æœªå‘½ä¸­** | æ•°ç™¾æ¡æŒ‡ä»¤æ—¶é—´ | æ•°ç™¾æ¡æŒ‡ä»¤ | ğŸŸ¡ ä¸­ç­‰ |

### ğŸ”¬ å¾®åŸºå‡†æµ‹è¯•ï¼šäº†è§£çœŸå®æˆæœ¬

**æœ€å¥½çš„å­¦ä¹ æ–¹æ³•**ï¼šè¿è¡Œå¾®åŸºå‡†æµ‹è¯•

```java
// ç®€å•çš„å¾®åŸºå‡†æµ‹è¯•ç¤ºä¾‹
public class PerformanceBenchmark {
    public static void main(String[] args) {
        // æµ‹è¯•HashMap vs TreeMap
        benchmarkMapOperations();
        
        // æµ‹è¯•æ•°ç»„åˆ†é…æ–¹å¼
        benchmarkArrayAllocation();
        
        // æµ‹è¯•å­—ç¬¦ä¸²æ“ä½œ
        benchmarkStringOperations();
    }
    
    private static void benchmarkMapOperations() {
        Map<String, Integer> hashMap = new HashMap<>();
        Map<String, Integer> treeMap = new TreeMap<>();
        
        // é¢„çƒ­
        for (int i = 0; i < 1000; i++) {
            hashMap.put("key" + i, i);
            treeMap.put("key" + i, i);
        }
        
        // æµ‹è¯•HashMap
        long start = System.nanoTime();
        for (int i = 0; i < 100000; i++) {
            hashMap.get("key" + (i % 1000));
        }
        long hashMapTime = System.nanoTime() - start;
        
        // æµ‹è¯•TreeMap
        start = System.nanoTime();
        for (int i = 0; i < 100000; i++) {
            treeMap.get("key" + (i % 1000));
        }
        long treeMapTime = System.nanoTime() - start;
        
        System.out.println("HashMap: " + hashMapTime + " ns");
        System.out.println("TreeMap: " + treeMapTime + " ns");
        System.out.println("HashMap is " + (treeMapTime / hashMapTime) + "x faster");
    }
}
```

**RAMCloudé¡¹ç›®çš„ç»éªŒ**ï¼š
- èŠ±å‡ å¤©æ—¶é—´åˆ›å»ºå¾®åŸºå‡†æµ‹è¯•æ¡†æ¶
- 5-10åˆ†é’Ÿå°±èƒ½æ·»åŠ æ–°çš„å¾®åŸºå‡†æµ‹è¯•
- ç§¯ç´¯äº†å‡ åä¸ªå¾®åŸºå‡†æµ‹è¯•
- æ—¢ç”¨äºç†è§£ç°æœ‰åº“çš„æ€§èƒ½ï¼Œä¹Ÿç”¨äºæµ‹é‡æ–°ä»£ç çš„æ€§èƒ½

### ğŸ¯ åŸºäºçŸ¥è¯†çš„é€‰æ‹©

ä¸€æ—¦äº†è§£äº†ä»€ä¹ˆæ˜‚è´µã€ä»€ä¹ˆä¾¿å®œï¼Œå°±å¯ä»¥åœ¨**ä¸å¢åŠ å¤æ‚æ€§**çš„æƒ…å†µä¸‹åšå‡ºæ›´å¥½çš„é€‰æ‹©ï¼š

**ç¤ºä¾‹1ï¼šæ•°æ®ç»“æ„é€‰æ‹©**
```java
// å­˜å‚¨å¤§é‡éœ€è¦æŒ‰é”®æŸ¥æ‰¾çš„å¯¹è±¡
// âœ… é€‰æ‹©HashMapï¼ˆå¿«5-10å€ï¼‰
Map<String, User> userMap = new HashMap<>();

// âŒ é™¤éä½ éœ€è¦æ’åºï¼Œå¦åˆ™ä¸è¦ç”¨TreeMap
// Map<String, User> userMap = new TreeMap<>();
```

**ç¤ºä¾‹2ï¼šæ•°ç»„åˆ†é…æ–¹å¼**
```java
// âŒ æ•ˆç‡ä½çš„æ–¹å¼ï¼šæ•°ç»„å­˜å‚¨æŒ‡é’ˆ
User[] users = new User[1000];
for (int i = 0; i < 1000; i++) {
    users[i] = new User();  // 1000æ¬¡å†…å­˜åˆ†é…
}

// âœ… æ›´é«˜æ•ˆçš„æ–¹å¼ï¼šé¢„åˆ†é…ç»“æ„æ•°ç»„
// åœ¨æ”¯æŒçš„è¯­è¨€ä¸­ï¼Œç›´æ¥åœ¨æ•°ç»„ä¸­å­˜å‚¨ç»“æ„
// åªéœ€è¦ä¸€æ¬¡å¤§çš„å†…å­˜åˆ†é…
```

**ç¤ºä¾‹3ï¼šå­—ç¬¦ä¸²å¤„ç†**
```java
// âŒ æ•ˆç‡ä½çš„æ–¹å¼
String result = "";
for (String item : items) {
    result += item + ",";  // æ¯æ¬¡éƒ½åˆ›å»ºæ–°å­—ç¬¦ä¸²
}

// âœ… æ›´é«˜æ•ˆçš„æ–¹å¼
StringBuilder result = new StringBuilder();
for (String item : items) {
    result.append(item).append(",");
}
return result.toString();
```

### âš–ï¸ å¤æ‚æ€§æƒè¡¡å†³ç­–

**å½“æé«˜æ•ˆç‡éœ€è¦å¢åŠ å¤æ‚æ€§æ—¶**ï¼Œå†³ç­–å˜å¾—æ›´å›°éš¾ï¼š

**å†³ç­–æ¡†æ¶**ï¼š
```markdown
å¦‚æœæ›´é«˜æ•ˆçš„è®¾è®¡ï¼š
âœ… åªå¢åŠ å°‘é‡å¤æ‚æ€§
âœ… å¤æ‚æ€§æ˜¯éšè—çš„ï¼ˆä¸å½±å“æ¥å£ï¼‰
âœ… æœ‰æ˜ç¡®è¯æ®è¡¨æ˜æ€§èƒ½å¾ˆé‡è¦
â†’ å¯èƒ½å€¼å¾—å®æ–½

å¦‚æœæ›´é«˜æ•ˆçš„è®¾è®¡ï¼š
âŒ å¢åŠ å¤§é‡å®ç°å¤æ‚æ€§
âŒ å¯¼è‡´æ›´å¤æ‚çš„æ¥å£
âŒ æ²¡æœ‰æ˜ç¡®çš„æ€§èƒ½éœ€æ±‚
â†’ å…ˆç”¨ç®€å•æ–¹æ³•ï¼Œå¿…è¦æ—¶å†ä¼˜åŒ–
```

### ğŸŒŸ RAMCloudçš„å®æˆ˜æ¡ˆä¾‹

**èƒŒæ™¯**ï¼šRAMCloudçš„ç›®æ ‡æ˜¯ä¸ºæ•°æ®ä¸­å¿ƒç½‘ç»œä¸Šçš„å®¢æˆ·ç«¯æä¾›**æœ€ä½å¯èƒ½çš„å»¶è¿Ÿ**ã€‚

**å…³é”®å†³ç­–**ï¼šä½¿ç”¨ç‰¹æ®Šç½‘ç»œç¡¬ä»¶
- **å¢åŠ çš„å¤æ‚æ€§**ï¼šç»•è¿‡å†…æ ¸ï¼Œç›´æ¥ä¸ç½‘ç»œæ¥å£æ§åˆ¶å™¨é€šä¿¡
- **ä¸ºä»€ä¹ˆå€¼å¾—**ï¼šå…ˆå‰çš„æµ‹é‡è¡¨æ˜åŸºäºå†…æ ¸çš„ç½‘ç»œå¤ªæ…¢ï¼Œæ— æ³•æ»¡è¶³éœ€æ±‚
- **ç»“æœ**ï¼šè§£å†³äº†è¿™ä¸ªå…³é”®é—®é¢˜ï¼Œè®©ç³»ç»Ÿçš„å…¶ä»–éƒ¨åˆ†éƒ½èƒ½ä¿æŒç®€å•

**ç»éªŒæ•™è®­**ï¼š
- åœ¨å…³é”®è·¯å¾„ä¸Šåšå‡ºæ­£ç¡®çš„æ ¹æœ¬æ€§å†³ç­–
- å¯ä»¥è®©ç³»ç»Ÿçš„å…¶ä»–éƒ¨åˆ†ä¿æŒç®€å•
- ä¸€ä¸ªå¤§é—®é¢˜çš„æ­£ç¡®è§£å†³æ–¹æ¡ˆï¼Œèƒœè¿‡æ— æ•°å°çš„ä¼˜åŒ–

### ğŸ’¡ ç®€å•æ€§ä¸æ€§èƒ½çš„å¤©ç„¶è”ç³»

**åç›´è§‰çš„çœŸç›¸**ï¼šç®€å•çš„ä»£ç å¾€å¾€æ¯”å¤æ‚çš„ä»£ç è·‘å¾—æ›´å¿«ï¼

**åŸå› **ï¼š
1. **æ¶ˆé™¤ç‰¹æ®Šæƒ…å†µ**ï¼šä¸éœ€è¦ä»£ç æ£€æŸ¥å„ç§è¾¹ç•Œæ¡ä»¶
2. **æ·±å±‚ç±»æ›´é«˜æ•ˆ**ï¼šæ¯æ¬¡æ–¹æ³•è°ƒç”¨å®Œæˆæ›´å¤šå·¥ä½œ
3. **å‡å°‘å±‚çº§ç©¿è¶Š**ï¼šæ¯ä¸ªå±‚çº§ç©¿è¶Šéƒ½å¢åŠ å¼€é”€
4. **æ›´å¥½çš„ç¼“å­˜æ€§èƒ½**ï¼šç®€å•çš„ä»£ç æœ‰æ›´å¥½çš„å±€éƒ¨æ€§

```java
// âŒ å¤æ‚çš„ä»£ç ï¼šå¤šå±‚æ£€æŸ¥ï¼Œå¤šæ¬¡æ–¹æ³•è°ƒç”¨
public class ComplexProcessor {
    public void process(Data data) {
        if (validateInput(data)) {
            if (preprocessData(data)) {
                if (checkPermissions(data)) {
                    if (transformData(data)) {
                        if (validateOutput(data)) {
                            storeData(data);
                        }
                    }
                }
            }
        }
    }
}

// âœ… ç®€å•çš„ä»£ç ï¼šä¸€æ¬¡æ£€æŸ¥ï¼Œç›´æ¥å¤„ç†
public class SimpleProcessor {
    public void process(Data data) {
        // ä¸€æ¬¡æ€§æ£€æŸ¥æ‰€æœ‰å‰ç½®æ¡ä»¶
        if (!isValidAndAuthorized(data)) {
            throw new ProcessingException("Invalid data");
        }
        
        // ç›´æ¥å¤„ç†ï¼Œæ— éœ€å¤šå±‚è°ƒç”¨
        data.transform();
        data.store();
    }
}
```

### ğŸ¯ å…³é”®æ´å¯Ÿ

> **æ€§èƒ½ä¼˜åŒ–çš„æœ€é«˜å¢ƒç•Œ**ï¼šé€‰æ‹©é‚£äº›æ—¢ç®€å•åˆé«˜æ•ˆçš„è®¾è®¡æ–¹æ¡ˆã€‚å½“ä½ å¿…é¡»åœ¨ç®€å•æ€§å’Œæ€§èƒ½ä¹‹é—´åšå‡ºæƒè¡¡æ—¶ï¼Œç¡®ä¿æœ‰æ˜ç¡®çš„è¯æ®è¯æ˜æ€§èƒ½çš„é‡è¦æ€§ã€‚

**å®è·µåŸåˆ™**ï¼š
1. **äº†è§£åŸºæœ¬æˆæœ¬**ï¼šçŸ¥é“å“ªäº›æ“ä½œæ˜‚è´µ
2. **è‡ªç„¶é€‰æ‹©**ï¼šåœ¨åŒæ ·ç®€å•çš„æ–¹æ¡ˆä¸­é€‰æ‹©æ›´å¿«çš„
3. **è°¨æ…æƒè¡¡**ï¼šåªæœ‰åœ¨æ˜ç¡®éœ€è¦æ—¶æ‰å¢åŠ å¤æ‚æ€§
4. **ç›¸ä¿¡ç®€å•**ï¼šç®€å•çš„è®¾è®¡é€šå¸¸ä¹Ÿæ˜¯å¿«é€Ÿçš„è®¾è®¡

---

## 20.2 ä¿®æ”¹å‰å…ˆæµ‹é‡ ğŸ“Š
*Measure before modifying*

### ğŸš¨ ç¨‹åºå‘˜ç›´è§‰çš„é™·é˜±

å‡è®¾ä½ çš„ç³»ç»Ÿå·²ç»æŒ‰ç…§ä¸Šé¢çš„åŸåˆ™è®¾è®¡äº†ï¼Œä½†ä»ç„¶å¤ªæ…¢ã€‚è¿™æ—¶å€™ï¼Œä½ å¯èƒ½ä¼šæœ‰å†²åŠ¨ï¼š

> "æˆ‘çŸ¥é“é—®é¢˜åœ¨å“ªé‡Œï¼è®©æˆ‘ç›´æ¥å»ä¼˜åŒ–é‚£ä¸ªçœ‹èµ·æ¥å¾ˆæ…¢çš„éƒ¨åˆ†ã€‚"

**ğŸ›‘ åœä¸‹æ¥ï¼ä¸è¦è¿™æ ·åšï¼**

**ç¨‹åºå‘˜å¯¹æ€§èƒ½çš„ç›´è§‰æ˜¯ä¸å¯é çš„**â€”â€”å³ä½¿æ˜¯ç»éªŒä¸°å¯Œçš„å¼€å‘è€…ä¹Ÿæ˜¯å¦‚æ­¤ã€‚

### ğŸ“‰ ç›´è§‰å¤±è´¥çš„çœŸå®æ¡ˆä¾‹

```java
// å¼€å‘è€…çš„ç›´è§‰ï¼š"è¿™ä¸ªå¾ªç¯è‚¯å®šå¾ˆæ…¢"
public List<String> processUsers(List<User> users) {
    List<String> results = new ArrayList<>();
    
    for (User user : users) {
        // å¼€å‘è€…è®¤ä¸ºï¼šè¿™ä¸ªå­—ç¬¦ä¸²æ‹¼æ¥è‚¯å®šæ˜¯ç“¶é¢ˆ
        String info = user.getName() + " - " + user.getEmail();
        results.add(info);
    }
    
    return results;
}

// å®é™…æµ‹é‡å‘ç°ï¼šçœŸæ­£çš„ç“¶é¢ˆåœ¨è¿™é‡Œ
public List<User> loadUsers() {
    // è¿™ä¸ªæ•°æ®åº“æŸ¥è¯¢æ‰æ˜¯çœŸæ­£çš„æ€§èƒ½æ€æ‰‹
    return database.query("SELECT * FROM users ORDER BY name");  // æ²¡æœ‰ç´¢å¼•ï¼
}
```

**å¸¸è§çš„é”™è¯¯å‡è®¾**ï¼š
- è®¤ä¸ºå¾ªç¯æ˜¯ç“¶é¢ˆï¼ˆå®é™…ä¸Šæ˜¯I/Oï¼‰
- è®¤ä¸ºå­—ç¬¦ä¸²æ“ä½œå¾ˆæ…¢ï¼ˆå®é™…ä¸Šæ˜¯ç½‘ç»œå»¶è¿Ÿï¼‰
- è®¤ä¸ºç®—æ³•å¤æ‚åº¦æ˜¯é—®é¢˜ï¼ˆå®é™…ä¸Šæ˜¯ç¼“å­˜æœªå‘½ä¸­ï¼‰

### ğŸ¯ æµ‹é‡çš„åŒé‡ç›®çš„

åœ¨è¿›è¡Œä»»ä½•æ€§èƒ½ä¼˜åŒ–ä¹‹å‰ï¼Œå¿…é¡»å…ˆæµ‹é‡ç³»ç»Ÿçš„ç°æœ‰è¡Œä¸ºã€‚è¿™æœ‰ä¸¤ä¸ªé‡è¦ç›®çš„ï¼š

#### ç›®çš„1ï¼šè¯†åˆ«çœŸæ­£çš„ç“¶é¢ˆ ğŸ”

**ä¸å¤Ÿçš„æµ‹é‡**ï¼š
```bash
# åªæµ‹é‡é¡¶å±‚æ€§èƒ½
$ time ./myapp
real    0m10.542s  # ç³»ç»Ÿå¤ªæ…¢ï¼Œä½†ä¸çŸ¥é“ä¸ºä»€ä¹ˆ
```

**æ·±å…¥çš„æµ‹é‡**ï¼š
```java
public class PerformanceProfiler {
    public void profileApplication() {
        // æµ‹é‡ä¸åŒç»„ä»¶çš„è€—æ—¶
        long startTime = System.nanoTime();
        
        // æ•°æ®åº“æ“ä½œ
        long dbStart = System.nanoTime();
        List<User> users = loadUsers();
        long dbTime = System.nanoTime() - dbStart;
        
        // æ•°æ®å¤„ç†
        long processStart = System.nanoTime();
        List<String> results = processUsers(users);
        long processTime = System.nanoTime() - processStart;
        
        // ç½‘ç»œä¼ è¾“
        long networkStart = System.nanoTime();
        sendResults(results);
        long networkTime = System.nanoTime() - networkStart;
        
        long totalTime = System.nanoTime() - startTime;
        
        // åˆ†æç»“æœ
        System.out.println("Total time: " + totalTime + " ns");
        System.out.println("Database: " + dbTime + " ns (" + (dbTime * 100 / totalTime) + "%)");
        System.out.println("Processing: " + processTime + " ns (" + (processTime * 100 / totalTime) + "%)");
        System.out.println("Network: " + networkTime + " ns (" + (networkTime * 100 / totalTime) + "%)");
    }
}
```

**çœŸå®çš„æ€§èƒ½åˆ†æç»“æœ**ï¼š
```
Total time: 10,542,000,000 ns
Database: 9,200,000,000 ns (87%)    <- çœŸæ­£çš„ç“¶é¢ˆï¼
Processing: 42,000,000 ns (0.4%)
Network: 1,300,000,000 ns (12.6%)
```

#### ç›®çš„2ï¼šå»ºç«‹åŸºå‡†çº¿ ğŸ“

**ä¸ºä»€ä¹ˆéœ€è¦åŸºå‡†çº¿**ï¼š
```java
// ä¼˜åŒ–å‰çš„æµ‹é‡
public void benchmarkBefore() {
    long start = System.nanoTime();
    for (int i = 0; i < 100000; i++) {
        processData(testData);
    }
    long baseline = System.nanoTime() - start;
    System.out.println("Baseline: " + baseline + " ns");
}

// ä¼˜åŒ–åçš„æµ‹é‡
public void benchmarkAfter() {
    long start = System.nanoTime();
    for (int i = 0; i < 100000; i++) {
        processDataOptimized(testData);
    }
    long optimized = System.nanoTime() - start;
    System.out.println("Optimized: " + optimized + " ns");
    
    // è®¡ç®—æ”¹è¿›
    double improvement = (double) baseline / optimized;
    System.out.println("Improvement: " + improvement + "x");
}
```

### ğŸ› ï¸ å®ç”¨çš„æ€§èƒ½æµ‹é‡å·¥å…·

**Javaæ€§èƒ½åˆ†æ**ï¼š
```java
public class DetailedProfiler {
    private Map<String, Long> timings = new HashMap<>();
    
    public void startTiming(String operation) {
        timings.put(operation + "_start", System.nanoTime());
    }
    
    public void endTiming(String operation) {
        long start = timings.get(operation + "_start");
        long duration = System.nanoTime() - start;
        timings.put(operation + "_duration", duration);
    }
    
    public void printReport() {
        System.out.println("Performance Report:");
        System.out.println("==================");
        
        for (String key : timings.keySet()) {
            if (key.endsWith("_duration")) {
                String operation = key.replace("_duration", "");
                long duration = timings.get(key);
                System.out.printf("%s: %.2f ms%n", operation, duration / 1_000_000.0);
            }
        }
    }
}

// ä½¿ç”¨ç¤ºä¾‹
public void processWithProfiling() {
    DetailedProfiler profiler = new DetailedProfiler();
    
    profiler.startTiming("database_query");
    List<User> users = loadUsers();
    profiler.endTiming("database_query");
    
    profiler.startTiming("data_processing");
    List<String> results = processUsers(users);
    profiler.endTiming("data_processing");
    
    profiler.startTiming("result_serialization");
    String json = serializeResults(results);
    profiler.endTiming("result_serialization");
    
    profiler.printReport();
}
```

### ğŸ“ˆ æ€§èƒ½æµ‹é‡çš„æœ€ä½³å®è·µ

**1. å¤šæ¬¡æµ‹é‡ï¼Œå–å¹³å‡å€¼**
```java
public double measureAverageTime(Runnable operation, int iterations) {
    // é¢„çƒ­
    for (int i = 0; i < iterations / 10; i++) {
        operation.run();
    }
    
    // æ­£å¼æµ‹é‡
    long totalTime = 0;
    for (int i = 0; i < iterations; i++) {
        long start = System.nanoTime();
        operation.run();
        totalTime += System.nanoTime() - start;
    }
    
    return totalTime / (double) iterations;
}
```

**2. ä½¿ç”¨ä¸“ä¸šå·¥å…·**
```java
// ä½¿ç”¨JMHè¿›è¡Œå¾®åŸºå‡†æµ‹è¯•
@Benchmark
public void testHashMapPerformance() {
    map.get("key" + random.nextInt(1000));
}

@Benchmark
public void testTreeMapPerformance() {
    treeMap.get("key" + random.nextInt(1000));
}
```

**3. åˆ†å±‚æµ‹é‡**
```java
public class LayeredProfiler {
    public void profileCompleteOperation() {
        // 1. ç³»ç»Ÿçº§åˆ«
        profileSystemLevel();
        
        // 2. ç»„ä»¶çº§åˆ«
        profileComponentLevel();
        
        // 3. æ–¹æ³•çº§åˆ«
        profileMethodLevel();
        
        // 4. è¯­å¥çº§åˆ«ï¼ˆå¿…è¦æ—¶ï¼‰
        profileStatementLevel();
    }
}
```

### ğŸ¯ æµ‹é‡é©±åŠ¨çš„ä¼˜åŒ–æµç¨‹

```markdown
æ€§èƒ½ä¼˜åŒ–çš„æ­£ç¡®æµç¨‹ï¼š
1. ğŸ“Š æµ‹é‡æ•´ä½“æ€§èƒ½
2. ğŸ” è¯†åˆ«å…·ä½“ç“¶é¢ˆ
3. ğŸ’¡ è®¾è®¡ä¼˜åŒ–æ–¹æ¡ˆ
4. ğŸ› ï¸ å®æ–½ä¼˜åŒ–
5. ğŸ“ é‡æ–°æµ‹é‡
6. âœ… éªŒè¯æ”¹è¿›æ•ˆæœ
7. ğŸ”„ å¦‚æœæ²¡æœ‰æ”¹è¿›ï¼Œå›æ»šæ›´æ”¹
```

### ğŸ’¡ å…³é”®åŸåˆ™

> **å¦‚æœä¼˜åŒ–æ²¡æœ‰äº§ç”Ÿå¯æµ‹é‡çš„æ€§èƒ½æ”¹è¿›ï¼Œå°±å›æ»šæ›´æ”¹**ï¼ˆé™¤éå®ƒä»¬è®©ç³»ç»Ÿå˜å¾—æ›´ç®€å•ï¼‰ã€‚

**ä¸ºä»€ä¹ˆè¿™å¾ˆé‡è¦**ï¼š
- é¿å…æ— æ•ˆçš„å¤æ‚æ€§
- ç¡®ä¿æ¯ä¸ªå¤æ‚æ€§éƒ½æœ‰æ˜ç¡®çš„å›æŠ¥
- é˜²æ­¢"ä¼˜åŒ–"å®é™…ä¸Šè®©ç³»ç»Ÿå˜æ…¢

**å®é™…æ¡ˆä¾‹**ï¼š
```java
// å¼€å‘è€…è®¤ä¸ºè¿™ä¸ª"ä¼˜åŒ–"ä¼šæ›´å¿«
public String formatUserInfo(User user) {
    // "ä¼˜åŒ–"ï¼šé¿å…å­—ç¬¦ä¸²æ‹¼æ¥
    StringBuilder sb = new StringBuilder();
    sb.append(user.getName());
    sb.append(" - ");
    sb.append(user.getEmail());
    return sb.toString();
}

// å®é™…æµ‹é‡å‘ç°ï¼šå¯¹äºçŸ­å­—ç¬¦ä¸²ï¼Œç›´æ¥æ‹¼æ¥æ›´å¿«
public String formatUserInfoSimple(User user) {
    return user.getName() + " - " + user.getEmail();  // æ›´å¿«ï¼
}
```

**æµ‹é‡ç»“æœ**ï¼š
```
Direct concatenation: 15 ns
StringBuilder approach: 45 ns
Simple approach is 3x faster for short strings!
```

### ğŸ¯ å…³é”®æ´å¯Ÿ

> **æ€§èƒ½ä¼˜åŒ–æ˜¯ä¸€ä¸ªå®è¯è¿‡ç¨‹ï¼Œä¸æ˜¯ç›´è§‰è¿‡ç¨‹**ã€‚æµ‹é‡æ˜¯ä½ æœ€å¯é çš„æœ‹å‹ï¼Œç›´è§‰æ˜¯ä½ æœ€å±é™©çš„æ•Œäººã€‚

**è®°ä½**ï¼š
- å…ˆæµ‹é‡ï¼Œå†ä¼˜åŒ–
- æ·±å…¥æµ‹é‡ï¼Œæ‰¾åˆ°çœŸæ­£çš„ç“¶é¢ˆ
- ä¼˜åŒ–åå†æµ‹é‡ï¼ŒéªŒè¯æ•ˆæœ
- æ²¡æœ‰æ”¹è¿›å°±å›æ»š

---

## 20.3 å›´ç»•å…³é”®è·¯å¾„è¿›è¡Œè®¾è®¡ ğŸ¯
*Design around the critical path*

### ğŸ›£ï¸ å½“åŸºæœ¬ä¿®å¤ä¸å¤Ÿæ—¶

å‡è®¾ä½ å·²ç»ä»”ç»†åˆ†æäº†æ€§èƒ½ï¼Œå¹¶è¯†åˆ«å‡ºäº†ä¸€æ®µå½±å“æ•´ä½“ç³»ç»Ÿæ€§èƒ½çš„æ…¢ä»£ç ã€‚

**ä¼˜å…ˆé€‰æ‹©ï¼šæ ¹æœ¬æ€§ä¿®å¤**
- å¼•å…¥ç¼“å­˜
- ä½¿ç”¨ä¸åŒçš„ç®—æ³•æ–¹æ³•ï¼ˆå¦‚å¹³è¡¡æ ‘vsé“¾è¡¨ï¼‰
- æ”¹å˜åŸºæœ¬æ¶æ„ï¼ˆå¦‚RAMCloudç»•è¿‡å†…æ ¸è¿›è¡Œç½‘ç»œé€šä¿¡ï¼‰

**å¦‚æœèƒ½æ‰¾åˆ°æ ¹æœ¬æ€§ä¿®å¤**ï¼Œå°±å¯ä»¥ä½¿ç”¨å‰é¢ç« èŠ‚è®¨è®ºçš„è®¾è®¡æŠ€æœ¯æ¥å®ç°å®ƒã€‚

### ğŸš¨ æœ€åçš„æ‰‹æ®µï¼šå…³é”®è·¯å¾„ä¼˜åŒ–

ä½†æœ‰æ—¶å€™ï¼Œä½ ä¼šé‡åˆ°**æ²¡æœ‰æ ¹æœ¬æ€§ä¿®å¤**çš„æƒ…å†µã€‚è¿™æ—¶å€™å°±éœ€è¦ä½¿ç”¨æœ¬ç« çš„æ ¸å¿ƒæŠ€æœ¯ï¼š

> **å›´ç»•å…³é”®è·¯å¾„é‡æ–°è®¾è®¡ç°æœ‰ä»£ç **

è¿™åº”è¯¥æ˜¯ä½ çš„**æœ€åæ‰‹æ®µ**ï¼Œä¸åº”è¯¥ç»å¸¸å‘ç”Ÿï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹å®ƒèƒ½å¸¦æ¥å·¨å¤§çš„å·®å¼‚ã€‚

### ğŸ’¡ å…³é”®è·¯å¾„è®¾è®¡çš„æ€ç»´è¿‡ç¨‹

**ç¬¬ä¸€æ­¥ï¼šæ‰¾åˆ°ç†æƒ³ä»£ç **

é—®è‡ªå·±ä¸€ä¸ªé—®é¢˜ï¼š
> åœ¨å¸¸è§æƒ…å†µä¸‹ï¼Œæ‰§è¡Œæ‰€éœ€ä»»åŠ¡çš„**æœ€å°‘ä»£ç é‡**æ˜¯å¤šå°‘ï¼Ÿ

**æ€ç»´å®éªŒ**ï¼š
- å¿½ç•¥ä»»ä½•ç°æœ‰çš„ä»£ç ç»“æ„
- å¿½ç•¥å½“å‰ä»£ç ä¸­çš„ç‰¹æ®Šæƒ…å†µ
- å¿½ç•¥å½“å‰ä»£ç å¯èƒ½ç»è¿‡çš„å¤šä¸ªæ–¹æ³•è°ƒç”¨
- å¿½ç•¥å½“å‰ä»£ç ä½¿ç”¨çš„å„ç§å˜é‡å’Œæ•°æ®ç»“æ„

**æƒ³è±¡ä½ åœ¨å†™ä¸€ä¸ªå…¨æ–°çš„æ–¹æ³•**ï¼š
- åªå®ç°å…³é”®è·¯å¾„
- åªè€ƒè™‘æœ€å¸¸è§çš„æƒ…å†µ
- åªä½¿ç”¨å¯¹å…³é”®è·¯å¾„æœ€æ–¹ä¾¿çš„æ•°æ®ç»“æ„
- å¯ä»¥å°†å¤šä¸ªå˜é‡åˆå¹¶ä¸ºå•ä¸ªå€¼
- å¯ä»¥å®Œå…¨é‡æ–°è®¾è®¡ç³»ç»Ÿæ¥æœ€å°åŒ–å…³é”®è·¯å¾„çš„ä»£ç 

**è¿™æ®µä»£ç å°±æ˜¯"ç†æƒ³ä»£ç "**ã€‚

### ğŸ¯ ä»ç†æƒ³åˆ°ç°å®çš„è®¾è®¡è¿‡ç¨‹

**ç¬¬äºŒæ­¥ï¼šå¯»æ‰¾æ¥è¿‘ç†æƒ³çš„è®¾è®¡**

ç†æƒ³ä»£ç å¯èƒ½ï¼š
- ä¸ç°æœ‰ç±»ç»“æ„å†²çª
- ä¸å¤ªå®ç”¨
- ä½†å®ƒæä¾›äº†ä¸€ä¸ªå¥½ç›®æ ‡ï¼šä»£ç èƒ½è¾¾åˆ°çš„æœ€ç®€å•å’Œæœ€å¿«çš„çŠ¶æ€

**è®¾è®¡æŒ‘æˆ˜**ï¼š
- æ‰¾åˆ°ä¸€ä¸ªå°½å¯èƒ½æ¥è¿‘ç†æƒ³çš„æ–°è®¾è®¡
- åŒæ—¶ä¿æŒå¹²å‡€çš„ç»“æ„
- åº”ç”¨æœ¬ä¹¦å‰é¢ç« èŠ‚çš„æ‰€æœ‰è®¾è®¡æ€æƒ³
- ä½†è¦ä¿æŒç†æƒ³ä»£ç ï¼ˆå¤§éƒ¨åˆ†ï¼‰å®Œæ•´

**å¯æ¥å—çš„å¦¥å**ï¼š
- å¯ä»¥ä¸ºç†æƒ³ä»£ç æ·»åŠ ä¸€äº›é¢å¤–ä»£ç æ¥å®ç°å¹²å‡€çš„æŠ½è±¡
- ä¾‹å¦‚ï¼Œå¦‚æœæ¶‰åŠå“ˆå¸Œè¡¨æŸ¥æ‰¾ï¼Œå¯ä»¥å¼•å…¥å¯¹é€šç”¨å“ˆå¸Œè¡¨ç±»çš„é¢å¤–æ–¹æ³•è°ƒç”¨

### ğŸ”¥ å…³é”®è·¯å¾„ä¼˜åŒ–çš„æ ¸å¿ƒæŠ€æœ¯

**æœ€é‡è¦çš„ä¼˜åŒ–ï¼šç§»é™¤ç‰¹æ®Šæƒ…å†µ**

**é—®é¢˜åˆ†æ**ï¼š
```java
// å…¸å‹çš„æ…¢ä»£ç ï¼šå……æ»¡ç‰¹æ®Šæƒ…å†µæ£€æŸ¥
public void processRequest(Request request) {
    if (request == null) {
        throw new IllegalArgumentException("Request cannot be null");
    }
    
    if (request.getType() == RequestType.SPECIAL_CASE_A) {
        handleSpecialCaseA(request);
        return;
    }
    
    if (request.getType() == RequestType.SPECIAL_CASE_B) {
        handleSpecialCaseB(request);
        return;
    }
    
    if (request.getSize() > MAX_SIZE) {
        handleLargeRequest(request);
        return;
    }
    
    if (request.getPriority() == Priority.HIGH) {
        handleHighPriorityRequest(request);
        return;
    }
    
    // ç»ˆäºåˆ°äº†æ­£å¸¸å¤„ç†é€»è¾‘
    processNormalRequest(request);
}
```

**ä¼˜åŒ–ç­–ç•¥**ï¼š
```java
// ä¼˜åŒ–åï¼šä¸€æ¬¡æ£€æŸ¥è¯†åˆ«æ‰€æœ‰ç‰¹æ®Šæƒ…å†µ
public void processRequest(Request request) {
    // ç†æƒ³æƒ…å†µï¼šç”¨ä¸€ä¸ªæ£€æŸ¥æ•è·æ‰€æœ‰ç‰¹æ®Šæƒ…å†µ
    if (isSpecialCase(request)) {
        handleSpecialCases(request);
        return;
    }
    
    // å…³é”®è·¯å¾„ï¼šæ— éœ€é¢å¤–æ£€æŸ¥
    processNormalRequest(request);
}

private boolean isSpecialCase(Request request) {
    return request == null || 
           request.getType() == RequestType.SPECIAL_CASE_A ||
           request.getType() == RequestType.SPECIAL_CASE_B ||
           request.getSize() > MAX_SIZE ||
           request.getPriority() == Priority.HIGH;
}
```

**å…³é”®è·¯å¾„ä¼˜åŒ–çš„å¥½å¤„**ï¼š
- æ­£å¸¸æƒ…å†µä¸‹åªéœ€è¦ä¸€æ¬¡æ£€æŸ¥
- å…³é”®è·¯å¾„å¯ä»¥æ— é¢å¤–æ£€æŸ¥åœ°æ‰§è¡Œ
- ç‰¹æ®Šæƒ…å†µè¢«ç§»åˆ°å…³é”®è·¯å¾„ä¹‹å¤–å¤„ç†
- ç‰¹æ®Šæƒ…å†µçš„æ€§èƒ½ä¸é‚£ä¹ˆé‡è¦ï¼Œå¯ä»¥ä¼˜åŒ–ç®€å•æ€§è€Œä¸æ˜¯æ€§èƒ½

### ğŸ“Š æ€§èƒ½ä¼˜åŒ–çš„å±‚æ¬¡ç»“æ„

| ä¼˜åŒ–å±‚æ¬¡ | æ–¹æ³• | å½±å“ | å¤æ‚æ€§ |
|---|---|---|---|
| **æ ¹æœ¬æ€§ä¿®å¤** | ç¼“å­˜ã€ç®—æ³•æ”¹è¿›ã€æ¶æ„å˜æ›´ | ğŸ”¥ æå¤§ | ğŸŸ¢ é€šå¸¸è¾ƒä½ |
| **å…³é”®è·¯å¾„ä¼˜åŒ–** | ç§»é™¤ç‰¹æ®Šæƒ…å†µã€å‡å°‘å±‚æ¬¡ | ğŸ”¥ å¤§ | ğŸŸ¡ ä¸­ç­‰ |
| **å¾®ä¼˜åŒ–** | å¾ªç¯å±•å¼€ã€å†…è”å‡½æ•° | ğŸ”¥ å° | ğŸ”´ é«˜ |

### ğŸ¯ å…³é”®è·¯å¾„è®¾è®¡çš„å®è·µæŒ‡å—

**1. è¯†åˆ«çœŸæ­£çš„å…³é”®è·¯å¾„**
```java
// ä¸è¦ä¼˜åŒ–è¿™ä¸ªï¼š
public void rareOperation() {
    // æ¯å¤©åªè°ƒç”¨ä¸€æ¬¡çš„æ“ä½œ
}

// ä¼˜åŒ–è¿™ä¸ªï¼š
public void frequentOperation() {
    // æ¯ç§’è°ƒç”¨10000æ¬¡çš„æ“ä½œ
}
```

**2. ä¸“æ³¨äºå¸¸è§æƒ…å†µ**
```java
// å…³é”®è·¯å¾„åº”è¯¥å¤„ç†90%+çš„æƒ…å†µ
public void handleCommonCase() {
    // 90%çš„è¯·æ±‚éƒ½æ˜¯è¿™ç§æƒ…å†µ
}

public void handleSpecialCases() {
    // 10%çš„ç‰¹æ®Šæƒ…å†µï¼Œæ€§èƒ½ä¸é‚£ä¹ˆé‡è¦
}
```

**3. æœ€å°åŒ–æ¡ä»¶æ£€æŸ¥**
```java
// âŒ å¤šæ¬¡æ£€æŸ¥
if (condition1) {
    if (condition2) {
        if (condition3) {
            // å…³é”®è·¯å¾„
        }
    }
}

// âœ… ä¸€æ¬¡æ£€æŸ¥
if (condition1 && condition2 && condition3) {
    // å…³é”®è·¯å¾„
} else {
    // å¤„ç†å„ç§ç‰¹æ®Šæƒ…å†µ
}
```

**4. å‡å°‘æ–¹æ³•è°ƒç”¨å±‚æ¬¡**
```java
// âŒ å¤šå±‚è°ƒç”¨
public void topLevel() {
    middleLevel();
}

private void middleLevel() {
    bottomLevel();
}

private void bottomLevel() {
    // å®é™…å·¥ä½œ
}

// âœ… ç›´æ¥è°ƒç”¨
public void topLevel() {
    // å®é™…å·¥ä½œç›´æ¥åœ¨è¿™é‡Œ
}
```

### ğŸ’¡ å…³é”®æ´å¯Ÿ

> **å…³é”®è·¯å¾„ä¼˜åŒ–çš„è‰ºæœ¯**ï¼šåœ¨ä¿æŒä»£ç æ¸…æ™°çš„åŒæ—¶ï¼Œè®©æœ€å¸¸è§çš„æ‰§è¡Œè·¯å¾„å°½å¯èƒ½ç®€å•å’Œå¿«é€Ÿã€‚

**è®¾è®¡åŸåˆ™**ï¼š
- ä¸€æ¬¡æ£€æŸ¥æ’é™¤æ‰€æœ‰ç‰¹æ®Šæƒ…å†µ
- å…³é”®è·¯å¾„æ— éœ€é¢å¤–æ£€æŸ¥
- ç‰¹æ®Šæƒ…å†µå¤„ç†å¯ä»¥å¤æ‚ä¸€äº›
- ä¿æŒæ•´ä½“æ¶æ„çš„æ¸…æ™°æ€§

---

## 20.4 å®æˆ˜æ¡ˆä¾‹ï¼šRAMCloudç¼“å†²åŒºä¼˜åŒ– ğŸš€
*An example: RAMCloud Buffers*

### ğŸ“‹ èƒŒæ™¯ï¼šRAMCloudçš„Bufferç±»

è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªçœŸå®çš„ä¾‹å­æ¥çœ‹çœ‹å…³é”®è·¯å¾„ä¼˜åŒ–æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚è¿™ä¸ªä¾‹å­ä¸­ï¼ŒRAMCloudå­˜å‚¨ç³»ç»Ÿçš„Bufferç±»é€šè¿‡ä¼˜åŒ–å®ç°äº†**2å€çš„æ€§èƒ½æå‡**ã€‚

**Bufferç±»çš„ä½œç”¨**ï¼š
- ç®¡ç†å¯å˜é•¿åº¦çš„å†…å­˜æ•°ç»„
- ç”¨äºè¿œç¨‹è¿‡ç¨‹è°ƒç”¨çš„è¯·æ±‚å’Œå“åº”æ¶ˆæ¯
- å‡å°‘å†…å­˜æ‹·è´å’ŒåŠ¨æ€å­˜å‚¨åˆ†é…çš„å¼€é”€

### ğŸ§© Bufferçš„è®¾è®¡ç†å¿µ

**è¡¨é¢ä¸Š**ï¼šBufferå­˜å‚¨ä¸€ä¸ªçº¿æ€§çš„å­—èŠ‚æ•°ç»„
**å®é™…ä¸Š**ï¼šä¸ºäº†æ•ˆç‡ï¼Œåº•å±‚å­˜å‚¨è¢«åˆ†ä¸ºå¤šä¸ªä¸è¿ç»­çš„å†…å­˜å—

```
Bufferå†…å­˜å¸ƒå±€ç¤ºä¾‹ï¼š
[å†…éƒ¨å—1][å¤–éƒ¨å—1][å¤–éƒ¨å—2][å†…éƒ¨å—2][å†…éƒ¨å—3]
    â†“        â†“        â†“        â†“        â†“
  Bufferæ‹¥æœ‰  å¼•ç”¨å¤–éƒ¨  å¼•ç”¨å¤–éƒ¨  Bufferæ‹¥æœ‰  Bufferæ‹¥æœ‰
```

**ä¸¤ç§å—ç±»å‹**ï¼š

**å¤–éƒ¨å—ï¼ˆExternal Chunksï¼‰**ï¼š
- å­˜å‚¨ç”±è°ƒç”¨è€…æ‹¥æœ‰
- Bufferåªä¿å­˜å¼•ç”¨
- ç”¨äºå¤§å—æ•°æ®ï¼Œé¿å…å†…å­˜æ‹·è´
- ä¾‹å¦‚ï¼šå¤§å¯¹è±¡çš„å†…å®¹

**å†…éƒ¨å—ï¼ˆInternal Chunksï¼‰**ï¼š
- å­˜å‚¨ç”±Bufferæ‹¥æœ‰
- è°ƒç”¨è€…çš„æ•°æ®è¢«æ‹·è´åˆ°Bufferçš„å†…éƒ¨å­˜å‚¨
- ç”¨äºå°å—æ•°æ®ï¼Œæ‹·è´æˆæœ¬å¯å¿½ç•¥
- ä¾‹å¦‚ï¼šæ¶ˆæ¯å¤´éƒ¨

### ğŸ¯ å®é™…åº”ç”¨åœºæ™¯

**å…¸å‹ç”¨ä¾‹**ï¼šç»„è£…å“åº”æ¶ˆæ¯
```java
// åˆ›å»ºåŒ…å«çŸ­å¤´éƒ¨å’Œå¤§å¯¹è±¡å†…å®¹çš„å“åº”æ¶ˆæ¯
Buffer response = new Buffer();

// ç¬¬ä¸€ä¸ªå—ï¼šå†…éƒ¨å—ï¼ˆåŒ…å«å¤´éƒ¨ï¼‰
response.appendInternal(headerData);

// ç¬¬äºŒä¸ªå—ï¼šå¤–éƒ¨å—ï¼ˆå¼•ç”¨å¤§å¯¹è±¡å†…å®¹ï¼Œæ— éœ€æ‹·è´ï¼‰
response.appendExternal(largeObjectData);

// ç»“æœï¼šæ— éœ€æ‹·è´å¤§å¯¹è±¡å°±èƒ½ç»„è£…å®Œæ•´å“åº”
```

### ğŸ“ˆ æ€§èƒ½é—®é¢˜çš„å‘ç°

**ä½¿ç”¨é‡å¢é•¿**ï¼š
- æœ€åˆBufferç±»æ²¡æœ‰ç‰¹åˆ«ä¼˜åŒ–
- éšç€æ—¶é—´æ¨ç§»ï¼ŒBufferè¢«è¶Šæ¥è¶Šå¤šåœ°ä½¿ç”¨
- æ¯ä¸ªè¿œç¨‹è¿‡ç¨‹è°ƒç”¨è‡³å°‘åˆ›å»º4ä¸ªBuffer
- Bufferæ“ä½œå¼€å§‹å½±å“æ•´ä½“ç³»ç»Ÿæ€§èƒ½

**å…³é”®è·¯å¾„è¯†åˆ«**ï¼š
- æœ€å¸¸è§çš„æ“ä½œï¼šä¸ºå°‘é‡æ–°æ•°æ®åˆ†é…å†…éƒ¨å—ç©ºé—´
- å…¸å‹åœºæ™¯ï¼šä¸ºè¯·æ±‚å’Œå“åº”æ¶ˆæ¯åˆ›å»ºå¤´éƒ¨
- å†³å®šå°†æ­¤æ“ä½œä½œä¸ºä¼˜åŒ–çš„å…³é”®è·¯å¾„

### ğŸ” åŸå§‹ä»£ç çš„æ€§èƒ½é—®é¢˜

**ç†æƒ³æƒ…å†µ**ï¼š
- é€šè¿‡æ‰©å¤§Bufferä¸­æœ€åä¸€ä¸ªç°æœ‰å—æ¥åˆ†é…ç©ºé—´
- å‰æï¼šæœ€åä¸€ä¸ªå—æ˜¯å†…éƒ¨å—ï¼Œä¸”æœ‰è¶³å¤Ÿç©ºé—´
- ç†æƒ³ä»£ç ï¼šä¸€æ¬¡æ£€æŸ¥ç¡®è®¤å¯è¡Œæ€§ï¼Œç„¶åè°ƒæ•´ç°æœ‰å—å¤§å°

**åŸå§‹ä»£ç çš„é—®é¢˜**ï¼š

```java
// åŸå§‹å…³é”®è·¯å¾„ï¼šBuffer::alloc -> Buffer::allocateAppend -> Buffer::Allocation::allocateAppend
public void* alloc(int numBytes) {
    // é—®é¢˜1ï¼šå¤šæ¬¡æ£€æŸ¥ç‰¹æ®Šæƒ…å†µ
    void* result = allocateAppend(numBytes);
    if (result == NULL) {
        // å¤„ç†å¤±è´¥æƒ…å†µ
    }
    
    // é—®é¢˜2ï¼šæ£€æŸ¥æ˜¯å¦éœ€è¦åˆå¹¶
    if (shouldMergeWithLastChunk(result)) {
        mergeWithLastChunk(result);
    }
    
    return result;
}

private void* allocateAppend(int numBytes) {
    // é—®é¢˜3ï¼šæ£€æŸ¥æ˜¯å¦æœ‰åˆ†é…
    if (allocations.empty()) {
        return NULL;
    }
    
    // é—®é¢˜4ï¼šå†æ¬¡æ£€æŸ¥ç©ºé—´
    return currentAllocation.allocateAppend(numBytes);
}
```

**å…·ä½“é—®é¢˜åˆ†æ**ï¼š

**é—®é¢˜1ï¼šå¤šæ¬¡ç‰¹æ®Šæƒ…å†µæ£€æŸ¥**
- `Buffer::allocateAppend`æ£€æŸ¥Bufferæ˜¯å¦æœ‰ä»»ä½•åˆ†é…
- ä»£ç ä¸¤æ¬¡æ£€æŸ¥å½“å‰åˆ†é…æ˜¯å¦æœ‰è¶³å¤Ÿç©ºé—´
- `Buffer::alloc`å†æ¬¡æµ‹è¯•è¿”å›å€¼ç¡®è®¤åˆ†é…æˆåŠŸ
- æ€»å…±æµ‹è¯•äº†6ç§ä¸åŒçš„æ¡ä»¶

**é—®é¢˜2ï¼šè¿‡å¤šçš„æµ…å±‚æ¬¡**
- å…³é”®è·¯å¾„è¿›è¡Œäº†2æ¬¡é¢å¤–çš„æ–¹æ³•è°ƒç”¨
- æ¯ä¸ªæ–¹æ³•è°ƒç”¨éƒ½éœ€è¦é¢å¤–æ—¶é—´
- æ¯ä¸ªè°ƒç”¨çš„ç»“æœéƒ½å¿…é¡»è¢«æ£€æŸ¥
- æ‰€æœ‰ä¸‰ä¸ªæ–¹æ³•éƒ½æœ‰ç›¸åŒçš„ç­¾åå’ŒæŠ½è±¡ï¼ˆçº¢è‰²è­¦å‘Šï¼ï¼‰

### âœ¨ ä¼˜åŒ–åçš„è®¾è®¡

**é‡æ„ç­–ç•¥**ï¼š
- å›´ç»•æœ€å…³é”®çš„æ€§èƒ½è·¯å¾„é‡æ–°è®¾è®¡
- ä¸åªè€ƒè™‘åˆ†é…ä»£ç ï¼Œè¿˜è€ƒè™‘å…¶ä»–å¸¸ç”¨è·¯å¾„
- åº”ç”¨æœ¬ä¹¦çš„è®¾è®¡åŸåˆ™ç®€åŒ–æ•´ä¸ªç±»
- æ¶ˆé™¤æµ…å±‚æ¬¡ï¼Œåˆ›å»ºæ›´æ·±çš„å†…éƒ¨æŠ½è±¡

**ç»“æœ**ï¼š
- é‡æ„åçš„ç±»æ¯”åŸç‰ˆæœ¬å°20%ï¼ˆ1476è¡Œ vs 1886è¡Œï¼‰
- æ€§èƒ½æå‡çº¦2å€

### ğŸš€ ä¼˜åŒ–åçš„å…³é”®è·¯å¾„

**æ–°çš„è®¾è®¡æ€è·¯**ï¼š
```java
public class OptimizedBuffer {
    private int extraAppendBytes;  // å…³é”®ï¼šæ–°å¢å®ä¾‹å˜é‡
    
    public void* alloc(int numBytes) {
        // ä¸€æ¬¡æ£€æŸ¥æ’é™¤æ‰€æœ‰ç‰¹æ®Šæƒ…å†µ
        if (extraAppendBytes >= numBytes) {
            // å…³é”®è·¯å¾„ï¼šæœ€å°‘çš„ä»£ç é‡
            void* result = getAppendPosition();
            extraAppendBytes -= numBytes;
            totalLength += numBytes;
            return result;
        }
        
        // ç‰¹æ®Šæƒ…å†µå¤„ç†ï¼ˆä¸åœ¨å…³é”®è·¯å¾„ä¸Šï¼‰
        return handleSpecialCases(numBytes);
    }
}
```

**å…³é”®åˆ›æ–°ï¼šextraAppendByteså˜é‡**
- è·Ÿè¸ªBufferä¸­æœ€åä¸€ä¸ªå—ä¹‹åç«‹å³å¯ç”¨çš„æœªä½¿ç”¨ç©ºé—´
- å¦‚æœæ²¡æœ‰å¯ç”¨ç©ºé—´ï¼Œæˆ–æœ€åä¸€ä¸ªå—ä¸æ˜¯å†…éƒ¨å—ï¼Œæˆ–Bufferæ²¡æœ‰å—ï¼Œåˆ™ä¸º0
- ç®€åŒ–äº†å…³é”®è·¯å¾„çš„æ£€æŸ¥

### ğŸ“Š æ€§èƒ½æ”¹è¿›ç»“æœ

**å…·ä½“æ€§èƒ½æ•°æ®**ï¼š
- ä½¿ç”¨å†…éƒ¨å­˜å‚¨å‘Bufferè¿½åŠ 1å­—èŠ‚å­—ç¬¦ä¸²ï¼š8.8ns â†’ 4.75nsï¼ˆ**1.85å€æå‡**ï¼‰
- æ„é€ æ–°Buffer + è¿½åŠ å°å— + é”€æ¯Bufferï¼š24ns â†’ 12nsï¼ˆ**2å€æå‡**ï¼‰
- è®¸å¤šå…¶ä»–Bufferæ“ä½œä¹Ÿå› ä¿®æ”¹è€ŒåŠ é€Ÿ

**ä»£ç è´¨é‡æ”¹è¿›**ï¼š
- ä»£ç æ›´æ˜“è¯»ï¼ˆé¿å…äº†æµ…å±‚æŠ½è±¡ï¼‰
- æ•´ä¸ªè·¯å¾„åœ¨å•ä¸ªæ–¹æ³•ä¸­å¤„ç†
- ä½¿ç”¨å•ä¸ªæµ‹è¯•æ’é™¤æ‰€æœ‰ç‰¹æ®Šæƒ…å†µ

### ğŸ’¡ è®¾è®¡æƒè¡¡çš„è€ƒè™‘

**totalLengthçš„æ›´æ–°**ï¼š
```java
// å¯ä»¥æ¶ˆé™¤è¿™ä¸ªæ›´æ–°ï¼š
totalLength += numBytes;

// é€šè¿‡åœ¨éœ€è¦æ—¶é‡æ–°è®¡ç®—ï¼š
public int getTotalLength() {
    int total = 0;
    for (Chunk chunk : chunks) {
        total += chunk.getLength();
    }
    return total;
}
```

**ä¸ºä»€ä¹ˆé€‰æ‹©ä¿ç•™æ›´æ–°**ï¼š
- å¯¹äºæœ‰å¾ˆå¤šå—çš„å¤§Bufferï¼Œé‡æ–°è®¡ç®—ä¼šå¾ˆæ˜‚è´µ
- è·å–Bufferæ€»é•¿åº¦æ˜¯å¦ä¸€ä¸ªå¸¸è§æ“ä½œ
- é€‰æ‹©åœ¨allocä¸­æ·»åŠ å°‘é‡é¢å¤–å¼€é”€ï¼Œç¡®ä¿Bufferé•¿åº¦å§‹ç»ˆç«‹å³å¯ç”¨

### ğŸ¯ å…³é”®ç»éªŒæ€»ç»“

**1. æ ¹æœ¬æ€§ä¿®å¤ + å…³é”®è·¯å¾„ä¼˜åŒ–**
- Bufferç±»æœ¬èº«å°±æ˜¯ä¸€ä¸ª"æ ¹æœ¬æ€§ä¿®å¤"ï¼ˆæ¶ˆé™¤æ˜‚è´µçš„å†…å­˜æ‹·è´ï¼‰
- åœ¨æ ¹æœ¬æ€§ä¿®å¤çš„åŸºç¡€ä¸Šï¼Œå†è¿›è¡Œå…³é”®è·¯å¾„ä¼˜åŒ–

**2. æ•´ä½“é‡æ„ï¼Œä¸æ˜¯å±€éƒ¨è¡¥ä¸**
- ä¸åªä¼˜åŒ–å•ä¸ªæ–¹æ³•ï¼Œè€Œæ˜¯é‡æ–°è®¾è®¡æ•´ä¸ªç±»
- åº”ç”¨æ‰€æœ‰è®¾è®¡åŸåˆ™ï¼Œä¸åªæ˜¯æ€§èƒ½ä¼˜åŒ–

**3. ç®€å•æ€§ä¸æ€§èƒ½çš„ç»Ÿä¸€**
- ä¼˜åŒ–åçš„ä»£ç ä¸ä»…æ›´å¿«ï¼Œè€Œä¸”æ›´ç®€å•
- å‡å°‘äº†ä»£ç è¡Œæ•°ï¼Œæé«˜äº†å¯è¯»æ€§

**4. æ•°æ®ç»“æ„ä¸ºæ€§èƒ½æœåŠ¡**
- å¼•å…¥`extraAppendBytes`å˜é‡ä¸“é—¨ä¸ºå…³é”®è·¯å¾„æœåŠ¡
- è¿™ä¸ªå˜é‡ç®€åŒ–äº†æœ€å¸¸è§æ“ä½œçš„é€»è¾‘

---

## 20.5 ç»“è®º ğŸ¯
*Conclusion*

### ğŸŒŸ æœ¬ç« çš„æ ¸å¿ƒæ´å¯Ÿ

é€šè¿‡RAMCloud Bufferç±»çš„å®æˆ˜æ¡ˆä¾‹ï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ª**ä»¤äººæƒŠè®¶ä½†é‡è¦çš„ç»“è®º**ï¼š

> **ç®€æ´çš„è®¾è®¡å’Œé«˜æ€§èƒ½æ˜¯å…¼å®¹çš„**

**Bufferç±»é‡å†™çš„æˆæœ**ï¼š
- æ€§èƒ½æå‡ï¼š**2å€**
- è®¾è®¡ç®€åŒ–ï¼šæ›´æ¸…æ™°çš„æ¶æ„
- ä»£ç å‡å°‘ï¼š**20%**ï¼ˆ1476è¡Œ vs 1886è¡Œï¼‰

è¿™å®Œå…¨é¢ è¦†äº†"æ€§èƒ½ä¼˜åŒ–å¿…é¡»ç‰ºç‰²ä»£ç ç®€æ´æ€§"çš„ä¼ ç»Ÿè§‚å¿µã€‚

### ğŸŒ å¤æ‚ä»£ç ä¸ºä»€ä¹ˆæ…¢ï¼Ÿ

**å¤æ‚ä»£ç çš„æ€§èƒ½é—®é¢˜**ï¼š
1. **å¤šä½™çš„å·¥ä½œ**ï¼šæ‰§è¡Œä¸å¿…è¦çš„æ£€æŸ¥å’Œæ“ä½œ
2. **å†—ä½™çš„å·¥ä½œ**ï¼šé‡å¤æ‰§è¡Œç›¸åŒçš„è®¡ç®—
3. **å±‚æ¬¡å¼€é”€**ï¼šå¤šå±‚æ–¹æ³•è°ƒç”¨çš„æˆæœ¬
4. **ç¼“å­˜ä¸å‹å¥½**ï¼šå¤æ‚çš„æ§åˆ¶æµå½±å“CPUç¼“å­˜

**å®é™…ä¾‹å­**ï¼š
```java
// å¤æ‚ä½†æ…¢çš„ä»£ç 
public void processData(Data data) {
    if (validateStep1(data)) {
        if (validateStep2(data)) {
            if (validateStep3(data)) {
                if (authorizeUser(data.getUser())) {
                    if (checkQuota(data.getUser())) {
                        if (preprocessData(data)) {
                            actualProcessing(data);
                        }
                    }
                }
            }
        }
    }
}
```

**æ¯ä¸ªæ£€æŸ¥éƒ½æ·»åŠ äº†**ï¼š
- æ¡ä»¶åˆ†æ”¯ï¼ˆå½±å“CPUæµæ°´çº¿ï¼‰
- æ–¹æ³•è°ƒç”¨å¼€é”€
- æ½œåœ¨çš„ç¼“å­˜æœªå‘½ä¸­

### ğŸš€ ç®€å•ä»£ç ä¸ºä»€ä¹ˆå¿«ï¼Ÿ

**ç®€å•ä»£ç çš„æ€§èƒ½ä¼˜åŠ¿**ï¼š
1. **ç›´æ¥æ‰§è¡Œ**ï¼šæœ€å°‘çš„é—´æ¥å±‚æ¬¡
2. **æ›´å¥½çš„ç¼“å­˜æ€§èƒ½**ï¼šçº¿æ€§çš„æ‰§è¡Œæµ
3. **ç¼–è¯‘å™¨ä¼˜åŒ–å‹å¥½**ï¼šç®€å•çš„æ§åˆ¶æµå®¹æ˜“ä¼˜åŒ–
4. **å‡å°‘åˆ†æ”¯é¢„æµ‹å¤±è´¥**ï¼šæ›´å°‘çš„æ¡ä»¶åˆ†æ”¯

**ä¼˜åŒ–åçš„ä¾‹å­**ï¼š
```java
// ç®€å•ä¸”å¿«çš„ä»£ç 
public void processData(Data data) {
    // ä¸€æ¬¡æ£€æŸ¥æ•è·æ‰€æœ‰é—®é¢˜
    if (!isValidAndAuthorized(data)) {
        handleInvalidData(data);
        return;
    }
    
    // ç›´æ¥å¤„ç†ï¼Œæ— éœ€å¤šå±‚æ£€æŸ¥
    actualProcessing(data);
}
```

### ğŸ¯ æ€§èƒ½ä¼˜åŒ–çš„å±‚æ¬¡åŒ–ç­–ç•¥

**æ¨èçš„ä¼˜åŒ–é¡ºåº**ï¼š

**1. é¦–å…ˆï¼šç¼–å†™ç®€æ´çš„ä»£ç **
```java
// ä»ä¸€å¼€å§‹å°±å†™ç®€æ´çš„ä»£ç 
public class SimpleDesign {
    public void doWork() {
        // æ¸…æ™°ã€ç›´æ¥çš„å®ç°
    }
}
```

**2. ç„¶åï¼šé€‰æ‹©è‡ªç„¶é«˜æ•ˆçš„æ–¹æ¡ˆ**
```java
// åœ¨åŒæ ·ç®€å•çš„æ–¹æ¡ˆä¸­é€‰æ‹©æ›´å¿«çš„
Map<String, User> users = new HashMap<>();  // è€Œä¸æ˜¯TreeMap
```

**3. å¿…è¦æ—¶ï¼šæ ¹æœ¬æ€§ä¿®å¤**
```java
// å¼•å…¥ç¼“å­˜ã€æ”¹å˜ç®—æ³•ã€æ¶æ„è°ƒæ•´
private Cache<String, Result> cache = new LRUCache<>();
```

**4. æœ€åï¼šå…³é”®è·¯å¾„ä¼˜åŒ–**
```java
// åªåœ¨å¿…è¦æ—¶é‡æ–°è®¾è®¡å…³é”®è·¯å¾„
public void criticalPath() {
    // å›´ç»•æœ€å¸¸è§æƒ…å†µä¼˜åŒ–
}
```

### ğŸ“Š æ€§èƒ½ä¼˜åŒ–çš„æŠ•èµ„å›æŠ¥

| ä¼˜åŒ–ç±»å‹ | æŠ•èµ„æˆæœ¬ | æ€§èƒ½æ”¶ç›Š | å¤æ‚æ€§å½±å“ | æ¨èç¨‹åº¦ |
|---|---|---|---|---|
| **ç®€æ´è®¾è®¡** | ğŸŸ¢ ä½ | ğŸŸ¢ ä¸­ç­‰ | ğŸŸ¢ é™ä½ | â­â­â­â­â­ |
| **è‡ªç„¶é«˜æ•ˆé€‰æ‹©** | ğŸŸ¢ ä½ | ğŸŸ¡ ä¸­ç­‰ | ğŸŸ¢ æ— å½±å“ | â­â­â­â­â­ |
| **æ ¹æœ¬æ€§ä¿®å¤** | ğŸŸ¡ ä¸­ç­‰ | ğŸ”¥ é«˜ | ğŸŸ¡ å¯æ§ | â­â­â­â­ |
| **å…³é”®è·¯å¾„ä¼˜åŒ–** | ğŸ”´ é«˜ | ğŸ”¥ é«˜ | ğŸ”´ å¢åŠ  | â­â­â­ |
| **å¾®ä¼˜åŒ–** | ğŸ”´ é«˜ | ğŸŸ¡ ä½ | ğŸ”´ å¤§å¹…å¢åŠ  | â­ |

### ğŸ’¡ å®è·µæŒ‡å¯¼åŸåˆ™

**1. æ€§èƒ½ä¼˜åŒ–çš„æ­£ç¡®å¿ƒæ€**
```markdown
âœ… æ­£ç¡®çš„æƒ³æ³•ï¼š
- "å¦‚ä½•è®©ä»£ç æ—¢ç®€å•åˆå¿«é€Ÿï¼Ÿ"
- "è¿™ä¸ªå¤æ‚æ€§çœŸçš„å¸¦æ¥äº†æ€§èƒ½æå‡å—ï¼Ÿ"
- "æœ‰æ²¡æœ‰æ›´ç®€å•çš„æ–¹æ³•è¾¾åˆ°åŒæ ·çš„æ€§èƒ½ï¼Ÿ"

âŒ é”™è¯¯çš„æƒ³æ³•ï¼š
- "ä¸ºäº†æ€§èƒ½ï¼Œæˆ‘å¿…é¡»è®©ä»£ç å˜å¤æ‚"
- "ä¼˜åŒ–å°±æ˜¯è¦å†™éš¾æ‡‚çš„ä»£ç "
- "æ€§èƒ½å’Œå¯è¯»æ€§æ˜¯çŸ›ç›¾çš„"
```

**2. ä¼˜åŒ–æ—¶æœºçš„é€‰æ‹©**
```markdown
ä¼˜å…ˆçº§é¡ºåºï¼š
1. ğŸ¯ å†™ç®€æ´çš„ä»£ç 
2. ğŸ“Š æµ‹é‡æ€§èƒ½
3. ğŸ” è¯†åˆ«ç“¶é¢ˆ
4. ğŸ› ï¸ å¯»æ‰¾æ ¹æœ¬æ€§ä¿®å¤
5. ğŸ¯ å…³é”®è·¯å¾„ä¼˜åŒ–ï¼ˆæœ€åæ‰‹æ®µï¼‰
```

**3. ä¼˜åŒ–æ•ˆæœçš„éªŒè¯**
```markdown
æ¯æ¬¡ä¼˜åŒ–åéƒ½è¦é—®ï¼š
- æ€§èƒ½çœŸçš„æå‡äº†å—ï¼Ÿï¼ˆç”¨æ•°æ®è¯´è¯ï¼‰
- ä»£ç å˜å¾—æ›´å¤æ‚äº†å—ï¼Ÿ
- è¿™ä¸ªå¤æ‚æ€§å€¼å¾—å—ï¼Ÿ
- æœ‰æ²¡æœ‰æ›´ç®€å•çš„æ›¿ä»£æ–¹æ¡ˆï¼Ÿ
```

### ğŸŒˆ æœ€ç»ˆæ€è€ƒ

**æ€§èƒ½ä¼˜åŒ–çš„æœ€é«˜å¢ƒç•Œ**ï¼š
> è®©ä½ çš„ç³»ç»Ÿæ—¢å¿«é€Ÿåˆç®€æ´ï¼Œè®©æ€§èƒ½ä¼˜åŒ–æˆä¸ºç®€åŒ–ä»£ç çš„åŠ¨åŠ›ï¼Œè€Œä¸æ˜¯å¤æ‚åŒ–çš„å€Ÿå£ã€‚

**è®°ä½è¿™ä¸ªçœŸç†**ï¼š
- å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç®€æ´çš„ä»£ç å°±è¶³å¤Ÿå¿«
- å½“éœ€è¦ä¼˜åŒ–æ—¶ï¼Œä¼˜å…ˆå¯»æ‰¾ç®€å•çš„è§£å†³æ–¹æ¡ˆ
- å¤æ‚æ€§åªæœ‰åœ¨å¸¦æ¥æ˜¾è‘—æ€§èƒ½æå‡æ—¶æ‰å€¼å¾—
- æœ€å¥½çš„ä¼˜åŒ–å¾€å¾€è®©ä»£ç å˜å¾—æ›´ç®€å•ï¼Œè€Œä¸æ˜¯æ›´å¤æ‚

**å®è·µå»ºè®®**ï¼š
1. **ä»ç®€å•å¼€å§‹**ï¼šå†™æ¸…æ™°ã€ç›´æ¥çš„ä»£ç 
2. **æµ‹é‡é©±åŠ¨**ï¼šç”¨æ•°æ®æŒ‡å¯¼ä¼˜åŒ–å†³ç­–
3. **å¯»æ‰¾æ ¹æœ¬**ï¼šä¼˜å…ˆè€ƒè™‘æ¶æ„çº§åˆ«çš„æ”¹è¿›
4. **ä¿æŒå¹³è¡¡**ï¼šåœ¨æ€§èƒ½å’Œç®€æ´æ€§ä¹‹é—´æ‰¾åˆ°æœ€ä½³å¹³è¡¡ç‚¹

---

*ğŸ‰ æ­å–œï¼ä½ å·²ç»æŒæ¡äº†æ€§èƒ½ä¼˜åŒ–çš„ç²¾é«“ï¼šç®€æ´æ€§å’Œé«˜æ€§èƒ½ä¸æ˜¯æ•Œäººï¼Œè€Œæ˜¯æœ€å¥½çš„æœ‹å‹ã€‚çœŸæ­£çš„æ€§èƒ½å¤§å¸ˆä¸æ˜¯è®©ä»£ç å˜å¾—å¤æ‚ï¼Œè€Œæ˜¯è®©å¿«é€Ÿçš„ä»£ç ä¿æŒç®€æ´ï¼*