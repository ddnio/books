# ç¬¬18ç«  ä»£ç åº”è¯¥æ˜¯æ˜¾è€Œæ˜“è§çš„ ğŸ§
*Chapter 18 Code Should be Obvious*

## ğŸ—ºï¸ å¼€ç¯‡æ•…äº‹ï¼šä¸€å¼ å¥½çš„åœ°å›¾

æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­£åœ¨ä¸€ä¸ªé™Œç”Ÿçš„åŸå¸‚é‡Œå¯»æ‰¾ä¸€ä¸ªè‘—åçš„æ™¯ç‚¹ã€‚ç°åœ¨ä½ æœ‰ä¸¤ç§åœ°å›¾å¯ä»¥é€‰æ‹©ï¼š

**åœ°å›¾Aï¼š**
- è·¯çº¿æ¸…æ™°ï¼Œåœ°æ ‡æ˜ç¡®
- è¡—é“åç§°ä¸€ç›®äº†ç„¶
- ä½ ä¸€çœ¼å°±èƒ½çœ‹æ‡‚ï¼Œæ¯«ä¸è´¹åŠ›åœ°æ‰¾åˆ°ç›®çš„åœ°

**åœ°å›¾Bï¼š**
- è·¯çº¿æ‚ä¹±æ— ç« ï¼Œå……æ»¡äº†å¥‡æ€ªçš„ç¬¦å·
- è¡—é“åç§°ç”¨çš„æ˜¯æ™¦æ¶©çš„ç¼©å†™
- ä½ éœ€è¦èŠ±è´¹å¤§é‡æ—¶é—´ç ”ç©¶ï¼Œç”šè‡³å¯èƒ½èµ°é”™è·¯

**å“ªå¼ åœ°å›¾æ›´å¥½ï¼Ÿ** ç­”æ¡ˆæ˜¾è€Œæ˜“è§ã€‚

è½¯ä»¶ä»£ç å°±æ˜¯ä¸€å¼ æŒ‡å¼•æˆ‘ä»¬ç†è§£ç³»ç»Ÿé€»è¾‘çš„åœ°å›¾ã€‚æ­£å¦‚ç¬¬2.3èŠ‚æ‰€è¯´ï¼Œ**æ™¦æ¶©éš¾æ‡‚**æ˜¯å¤æ‚æ€§çš„ä¸¤å¤§å…ƒå‡¶ä¹‹ä¸€ã€‚å½“ç³»ç»Ÿçš„é‡è¦ä¿¡æ¯å¯¹æ–°å¼€å‘è€…ä¸æ˜æ˜¾æ—¶ï¼Œä»£ç å°±å˜å¾—æ™¦æ¶©äº†ã€‚

> **æ ¸å¿ƒåŸåˆ™**ï¼šè§£å†³æ™¦æ¶©é—®é¢˜çš„å”¯ä¸€æ–¹æ³•ï¼Œå°±æ˜¯ä»¥**æ˜¾è€Œæ˜“è§**çš„æ–¹å¼ç¼–å†™ä»£ç ã€‚

### ğŸ¤” ä»€ä¹ˆæ˜¯"æ˜¾è€Œæ˜“è§"çš„ä»£ç ï¼Ÿ

å¦‚æœä¸€æ®µä»£ç æ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œé‚£ä¹ˆï¼š
- **å¿«é€Ÿç†è§£**ï¼šä½ ä¸éœ€è¦åå¤ç¢ç£¨ï¼Œå°±èƒ½å¿«é€Ÿè¯»æ‡‚
- **ç¬¬ä¸€å°è±¡æ­£ç¡®**ï¼šä½ å¯¹ä»£ç è¡Œä¸ºå’Œå«ä¹‰çš„åˆæ­¥çŒœæµ‹å°±æ˜¯æ­£ç¡®çš„
- **ä¿¡æ¯è·å–å®¹æ˜“**ï¼šä½ ä¸éœ€è¦èŠ±è´¹å¤§é‡æ—¶é—´å’Œç²¾åŠ›å°±èƒ½æ”¶é›†åˆ°æ‰€æœ‰éœ€è¦çš„ä¿¡æ¯

ç›¸åï¼Œå¦‚æœä»£ç ä¸æ˜æ˜¾ï¼Œä½ ä¼šï¼š
- æµªè´¹å¤§é‡æ—¶é—´å»ç†è§£å®ƒ
- æ•ˆç‡ä½ä¸‹
- å¢åŠ è¯¯è§£å’Œå¼•å…¥bugçš„å¯èƒ½æ€§

> **æœ‰è¶£çš„äº‹å®**ï¼šæ˜¾è€Œæ˜“è§çš„ä»£ç æ¯”ä¸æ˜æ˜¾çš„ä»£ç éœ€è¦æ›´å°‘çš„æ³¨é‡Šã€‚å› ä¸ºä»£ç æœ¬èº«å°±åœ¨è¯´è¯ï¼

### ğŸ§ "æ˜¾è€Œæ˜“è§"æ˜¯è°çš„æ„Ÿå—ï¼Ÿ

"æ˜¾è€Œæ˜“è§"æ˜¯**è¯»è€…**çš„æ„Ÿå—ï¼Œè€Œä¸æ˜¯ä½œè€…çš„ã€‚

- ä½ å¾ˆå®¹æ˜“å‘ç°åˆ«äººçš„ä»£ç æ™¦æ¶©éš¾æ‡‚
- å´å¾ˆéš¾çœ‹åˆ°è‡ªå·±ä»£ç é‡Œçš„é—®é¢˜

**æœ€ä½³éªŒè¯æ–¹æ³•ï¼šä»£ç å®¡æŸ¥ï¼ˆCode Reviewï¼‰**

å¦‚æœæœ‰äººåœ¨è¯»ä½ çš„ä»£ç æ—¶è¯´ï¼š"è¿™é‡Œæˆ‘çœ‹ä¸æ‡‚"ï¼Œé‚£ä¹ˆæ— è®ºä½ è§‰å¾—å®ƒå¤šæ¸…æ™°ï¼Œå®ƒå°±æ˜¯**ä¸æ˜æ˜¾**çš„ã€‚ä½ åº”è¯¥æ„Ÿè°¢è¿™ä½è¯»è€…ï¼Œå¹¶å°è¯•ç†è§£æ˜¯ä»€ä¹ˆè®©ä»–æ„Ÿåˆ°å›°æƒ‘ï¼Œè¿™æ ·ä½ æœªæ¥æ‰èƒ½å†™å‡ºæ›´å¥½çš„ä»£ç ã€‚

---

## 18.1 è®©ä»£ç æ›´æ˜æ˜¾çš„æ–¹æ³• âœ¨
*Things that make code more obvious*

è¦è®©ä½ çš„ä»£ç åƒä¸€å¼ æ¸…æ™°çš„åœ°å›¾ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‡ ç§å¼ºå¤§çš„æŠ€æœ¯ï¼š

### ğŸ·ï¸ 1. èµ·ä¸ªå¥½åå­—ï¼ˆç¬¬14ç« ç²¾åå›é¡¾ï¼‰

**ç²¾ç¡®ä¸”æœ‰æ„ä¹‰çš„åå­—**æ˜¯ä»£ç æ¸…æ™°åº¦çš„åŸºçŸ³ã€‚

```java
// âŒ ä¸æ˜æ˜¾çš„åå­—
public class Manager {
    public void processData(List<Item> items) {
        for (Item i : items) {
            if (i.status == 1) {
                // ...
            }
        }
    }
}

// âœ… æ˜æ˜¾çš„åå­—
public class ExpiredLicenseManager {
    public void deactivateExpiredLicenses(List<License> licenses) {
        for (License license : licenses) {
            if (license.isExpired()) {
                deactivate(license);
            }
        }
    }
}
```

- **ä¸å¥½çš„åå­—**ï¼šè¿«ä½¿è¯»è€…æ·±å…¥ä»£ç å»æ¨æ–­å…¶çœŸå®å«ä¹‰
- **å¥½çš„åå­—**ï¼šç›´æ¥é˜æ˜ä»£ç è¡Œä¸ºï¼Œå‡å°‘å¯¹æ–‡æ¡£çš„ä¾èµ–

### ğŸ›ï¸ 2. ä¿æŒä¸€è‡´æ€§ï¼ˆç¬¬17ç« ç²¾åå›é¡¾ï¼‰

**ç›¸ä¼¼çš„äº‹æƒ…ç”¨ç›¸ä¼¼çš„æ–¹å¼å¤„ç†**ï¼Œè¿™èƒ½è®©è¯»è€…åˆ©ç”¨å·²æœ‰çš„çŸ¥è¯†ã€‚

```java
// âœ… ä¸€è‡´çš„æ¨¡å¼
// ç”¨æˆ·æœåŠ¡
public User getUser(String id) { ... }
public void deleteUser(String id) { ... }

// è®¢å•æœåŠ¡ (éµå¾ªç›¸åŒæ¨¡å¼)
public Order getOrder(String id) { ... }
public void deleteOrder(String id) { ... }
```

å½“è¯»è€…çœ‹åˆ° `getOrder`ï¼Œä»–ä»¬å¯ä»¥å®‰å…¨åœ°å‡è®¾å®ƒå’Œ `getUser` çš„è¡Œä¸ºç±»ä¼¼ï¼Œè€Œæ— éœ€æ·±å…¥åˆ†æä»£ç ã€‚

### ğŸ“„ 3. æ˜æ™ºåœ°ä½¿ç”¨ç©ºç™½

æ ¼å¼åŒ–èƒ½å¤Ÿæå¤§åœ°å½±å“ä»£ç çš„å¯è¯»æ€§ã€‚

**ç¤ºä¾‹1ï¼šå‚æ•°æ–‡æ¡£**

```java
// âŒ æŒ¤åœ¨ä¸€èµ·çš„æ–‡æ¡£
/**
 * ...
 * @param numThreads The number of threads...should be at least equal to...
 * @param handler Used as a callback in order to handle incoming messages...
 */

// âœ… ä½¿ç”¨ç©ºç™½åçš„æ–‡æ¡£
/**
 * @param numThreads
 *           The number of threads that this manager should spin up in
 *           order to manage ongoing connections. The MessageManager spins
 *           up at least one thread for every open connection...
 * 
 * @param handler
 *           Used as a callback in order to handle incoming messages on
 *           this MessageManager's open connections. See
 *           {@code MessageHandler} and {@code handleMessage} for details.
 */
```
**æ”¹è¿›æ•ˆæœ**ï¼š
- ç»“æ„æ¸…æ™°
- å‚æ•°åˆ†ç¦»
- å®¹æ˜“å¿«é€Ÿæ‰«æ

**ç¤ºä¾‹2ï¼šæ–¹æ³•å†…ä»£ç å—**

```java
// âŒ æ²¡æœ‰ç©ºè¡Œçš„ä»£ç å—
void* Buffer::allocAux(size_t numBytes) {
    uint32_t numBytes32 = (downCast<uint32_t>(numBytes) + 7) & ~0x7;
    assert(numBytes32 != 0);
    if (availableLength >= numBytes32) {
        availableLength -= numBytes32;
        return firstAvailable + availableLength;
    }
    if (extraAppendBytes >= numBytes32) {
        extraAppendBytes -= numBytes32;
        return lastChunk->data + lastChunk->length + extraAppendBytes;
    }
    uint32_t allocatedLength;
    firstAvailable = getNewAllocation(numBytes32, &allocatedLength);
    availableLength = allocatedLength - numBytes32;
    return firstAvailable + availableLength;
}

// âœ… ä½¿ç”¨ç©ºè¡Œåˆ†ç¦»é€»è¾‘å—
void* Buffer::allocAux(size_t numBytes) {
    // Round up the length to a multiple of 8 bytes, to ensure alignment.
    uint32_t numBytes32 = (downCast<uint32_t>(numBytes) + 7) & ~0x7;
    assert(numBytes32 != 0);

    // If there is enough memory at firstAvailable, use that.
    if (availableLength >= numBytes32) {
        availableLength -= numBytes32;
        return firstAvailable + availableLength;
    }

    // Next, see if there is extra space at the end of the last chunk.
    if (extraAppendBytes >= numBytes32) {
        extraAppendBytes -= numBytes32;
        return lastChunk->data + lastChunk->length + extraAppendBytes;
    }

    // Must create a new space allocation; allocate space within it.
    uint32_t allocatedLength;
    firstAvailable = getNewAllocation(numBytes32, &allocatedLength);
    availableLength = allocatedLength - numBytes32;
    return firstAvailable + availableLength;
}
```
**é»„é‡‘ç»„åˆ**ï¼šç©ºè¡Œ + æè¿°æ€§æ³¨é‡Šï¼Œè®©ä»£ç ç»“æ„ä¸€ç›®äº†ç„¶ã€‚

**ç¤ºä¾‹3ï¼šè¯­å¥å†…ç©ºç™½**

| æ— ç©ºç™½ (ä¸æ˜æ˜¾) | æœ‰ç©ºç™½ (æ˜æ˜¾) |
|---|---|
| `for(int i=0;i<10;i++){` | `for (int i = 0; i < 10; i++) {` |
| `if(x>0&&y<0){` | `if (x > 0 && y < 0) {` |

### ğŸ’¬ 4. å¿…è¦çš„æ³¨é‡Š

å½“ä½ æ— æ³•é¿å…å†™å‡ºä¸é‚£ä¹ˆæ˜æ˜¾ï¼ˆä½†å¯èƒ½æ˜¯å¿…è¦çš„ï¼‰çš„ä»£ç æ—¶ï¼Œ**æ³¨é‡Š**å°±æ˜¯ä½ çš„æ•‘æ˜Ÿã€‚

> **æ³¨é‡Šçš„è‰ºæœ¯**ï¼šæŠŠè‡ªå·±æ”¾åœ¨è¯»è€…çš„ä½ç½®ï¼Œæ€è€ƒä»–ä»¬å¯èƒ½ä¼šå›°æƒ‘ä»€ä¹ˆï¼Œç„¶åç”¨æ³¨é‡Šæä¾›è¿™äº›ç¼ºå¤±çš„ä¿¡æ¯ã€‚

---

## 18.2 è®©ä»£ç ä¸é‚£ä¹ˆæ˜æ˜¾çš„äº‹æƒ… ğŸš©
*Things that make code less obvious*

äº†è§£å“ªäº›æ¨¡å¼ä¼šå¤©ç„¶åœ°å¯¼è‡´ä»£ç æ™¦æ¶©ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬æœ‰æ„è¯†åœ°é¿å…æˆ–è¡¥å¿å®ƒä»¬ã€‚

### âš¡ 1. äº‹ä»¶é©±åŠ¨ç¼–ç¨‹

åœ¨äº‹ä»¶é©±åŠ¨ç¼–ç¨‹ä¸­ï¼Œä»£ç å“åº”å¤–éƒ¨äº‹ä»¶ï¼ˆå¦‚ç‚¹å‡»æŒ‰é’®ã€æ”¶åˆ°ç½‘ç»œåŒ…ï¼‰ã€‚

**é—®é¢˜**ï¼š**éš¾ä»¥è¿½è¸ªæ§åˆ¶æµ**ã€‚

```java
// äº‹ä»¶å‘å¸ƒè€…
public class EventBus {
    public void register(EventHandler handler) { ... }
    public void post(Event event) {
        // åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸çŸ¥é“å…·ä½“ä¼šè°ƒç”¨å“ªä¸ªhandler
        // è¿™å–å†³äºè¿è¡Œæ—¶æ³¨å†Œäº†å“ªäº›handler
        handler.handle(event); 
    }
}

// äº‹ä»¶å¤„ç†å™¨
public class UserLoginHandler implements EventHandler {
    @Override
    public void handle(Event event) {
        // è¿™ä¸ªæ–¹æ³•ä»ä¸ä¼šè¢«ç›´æ¥è°ƒç”¨
        // å®ƒæ˜¯è¢« EventBus é—´æ¥è°ƒç”¨çš„
        System.out.println("User has logged in!");
    }
}
```
**æŒ‘æˆ˜**ï¼š
- å¾ˆéš¾æ¨ç†ä»£ç çš„æ‰§è¡Œé¡ºåº
- å¾ˆéš¾è¯´æœè‡ªå·±ä»£ç æ˜¯æ­£ç¡®çš„

**è¡¥å¿æ–¹æ¡ˆ**ï¼š**åœ¨æ³¨é‡Šä¸­æ˜ç¡®è°ƒç”¨æ—¶æœº**ã€‚

```java
/**
 * å½“RPCå› ä¸ºä¼ è¾“å±‚é”™è¯¯è€Œæ— æ³•å®Œæˆæ—¶ï¼Œ
 * è¿™ä¸ªæ–¹æ³•ä¼šè¢«åˆ†å‘çº¿ç¨‹åœ¨ä¸€ä¸ªä¼ è¾“(transport)ä¸­è°ƒç”¨ã€‚
 */
void Transport::RpcNotifier::failed() {
    // ...
}
```

> ### ğŸš© å±é™©ä¿¡å·ï¼šä¸æ˜æ˜¾çš„ä»£ç 
> 
> å¦‚æœä¸€æ®µä»£ç çš„å«ä¹‰å’Œè¡Œä¸ºæ— æ³•é€šè¿‡å¿«é€Ÿé˜…è¯»æ¥ç†è§£ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªå±é™©ä¿¡å·ã€‚è¿™é€šå¸¸æ„å‘³ç€æœ‰é‡è¦çš„ä¿¡æ¯å¯¹è¯»è€…æ¥è¯´ä¸æ˜¯ç«‹å³å¯è§çš„ã€‚

### ğŸ“¦ 2. é€šç”¨å®¹å™¨ (Generic Containers)

åƒJavaçš„`Pair`æˆ–C++çš„`std::pair`è¿™æ ·çš„é€šç”¨å®¹å™¨éå¸¸è¯±äººï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥è½»æ¾åœ°å°†å¤šä¸ªå€¼æ‰“åŒ…åœ¨ä¸€èµ·è¿”å›ã€‚

**é—®é¢˜**ï¼š**åˆ†ç»„çš„å…ƒç´ åå­—æ˜¯é€šç”¨çš„ï¼Œæ©ç›–äº†å®ƒä»¬çš„çœŸå®å«ä¹‰**ã€‚

```java
// ä»ä¸€ä¸ªæ–¹æ³•è¿”å›å¤šä¸ªå€¼
return new Pair<Integer, Boolean>(currentTerm, false);

// è°ƒç”¨è€…å¦‚ä½•ä½¿ç”¨ï¼Ÿ
Pair<Integer, Boolean> result = someMethod();
int term = result.getKey();      // getKey() æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ
boolean voted = result.getValue(); // getValue() åˆæ˜¯ä»€ä¹ˆï¼Ÿ
```
**æŒ‘æˆ˜**ï¼š
- `getKey()`å’Œ`getValue()`æ²¡æœ‰æä¾›ä»»ä½•å…³äºå€¼çš„å®é™…å«ä¹‰çš„çº¿ç´¢
- è¯»è€…å¿…é¡»å»`someMethod`çš„å®ç°ä¸­æ‰èƒ½ç†è§£è¿”å›å€¼çš„æ„ä¹‰

**æ›´å¥½çš„æ–¹æ¡ˆ**ï¼š**å®šä¹‰ä¸€ä¸ªä¸“ç”¨çš„ç±»æˆ–ç»“æ„ä½“**ã€‚

```java
// å®šä¹‰ä¸€ä¸ªä¸“ç”¨çš„è¿”å›ç±»å‹
public class VoteResult {
    public final int term;
    public final boolean voteGranted;

    public VoteResult(int term, boolean voteGranted) {
        this.term = term;
        this.voteGranted = voteGranted;
    }
}

// è¿”å›ä¸€ä¸ªæ˜æ˜¾çš„å¯¹è±¡
return new VoteResult(currentTerm, false);

// è°ƒç”¨è€…ä½¿ç”¨èµ·æ¥éå¸¸æ¸…æ™°
VoteResult result = someMethod();
int term = result.term;
boolean voted = result.voteGranted;
```

> ### ğŸ“– è®¾è®¡é»„é‡‘æ³•åˆ™
> 
> **è½¯ä»¶åº”è¯¥ä¸ºæ˜“äºé˜…è¯»è€Œè®¾è®¡ï¼Œè€Œä¸æ˜¯ä¸ºæ˜“äºç¼–å†™è€Œè®¾è®¡ã€‚**
> 
> ç¼–å†™ä»£ç çš„äººèŠ±å‡ åˆ†é’Ÿå®šä¹‰ä¸€ä¸ªä¸“ç”¨å®¹å™¨ï¼Œå¯ä»¥ä¸ºåæ¥æ‰€æœ‰çš„è¯»è€…èŠ‚çœå¤§é‡çš„æ—¶é—´å’Œå›°æƒ‘ã€‚

### ğŸ­ 3. å£°æ˜å’Œåˆ†é…ç±»å‹ä¸åŒ

åœ¨Javaä¸­ï¼Œä½ å¯ä»¥ç”¨çˆ¶ç±»æˆ–æ¥å£æ¥å£°æ˜å˜é‡ï¼Œç”¨å­ç±»æ¥å®ä¾‹åŒ–å®ƒã€‚

```java
private List<Message> incomingMessageList;
...
incomingMessageList = new ArrayList<Message>();
```
**é—®é¢˜**ï¼š**å¯èƒ½ä¼šè¯¯å¯¼è¯»è€…**ã€‚

- è¯»è€…åªçœ‹åˆ°å£°æ˜ `List`ï¼Œå¯èƒ½ä¼šå¯¹å®ƒçš„æ€§èƒ½å’Œçº¿ç¨‹å®‰å…¨åšå‡ºé”™è¯¯çš„å‡è®¾ã€‚
- `ArrayList` å’Œ `LinkedList` çš„è¡Œä¸ºå’Œæ€§èƒ½ç‰¹å¾æ˜¯æˆªç„¶ä¸åŒçš„ã€‚

**æ›´å¥½çš„æ–¹æ¡ˆ**ï¼š**è®©å£°æ˜å’Œåˆ†é…çš„ç±»å‹åŒ¹é…**ã€‚

```java
// å¦‚æœä½ çœŸçš„éœ€è¦ä¸€ä¸ªArrayListï¼Œå°±è¿™æ ·å£°æ˜å®ƒ
private ArrayList<Message> incomingMessageList;
...
incomingMessageList = new ArrayList<Message>();

// æˆ–è€…ï¼Œå¦‚æœæ¥å£è¶³å¤Ÿï¼Œç¡®ä¿å®ç°ä¸é‡è¦
// å¹¶åœ¨å¿…è¦æ—¶æ³¨é‡Š
private List<Message> incomingMessageList; // æ€§èƒ½éå…³é”®ï¼Œä»»ä½•Listå®ç°å‡å¯
```

### ğŸ¤¯ 4. è¿åè¯»è€…æœŸæœ›çš„ä»£ç 

ä»£ç æœ€æ˜æ˜¾çš„æ—¶å€™ï¼Œæ˜¯å®ƒç¬¦åˆè¯»è€…çš„æ™®éé¢„æœŸã€‚å¦‚æœå®ƒä¸ç¬¦åˆï¼Œå°±å¿…é¡»æ˜ç¡®è¯´æ˜ã€‚

**ç¤ºä¾‹**ï¼šJavaç¨‹åºçš„ `main` æ–¹æ³•

```java
public static void main(String[] args) {
    ...
    new RaftClient(myAddress, serverAddresses);
}
```
**è¯»è€…çš„æ™®éé¢„æœŸ**ï¼š`main` æ–¹æ³•æ‰§è¡Œå®Œæ¯•ï¼Œç¨‹åºå°±é€€å‡ºäº†ã€‚

**å®é™…è¡Œä¸º**ï¼š`RaftClient`çš„æ„é€ å‡½æ•°åˆ›å»ºäº†æ–°çš„åå°çº¿ç¨‹ï¼Œå³ä½¿ä¸»çº¿ç¨‹ç»“æŸäº†ï¼Œç¨‹åºä¾ç„¶åœ¨è¿è¡Œã€‚

**è¡¥å¿æ–¹æ¡ˆ**ï¼š**åœ¨æ³¨é‡Šä¸­è¯´æ˜éå…¸å‹è¡Œä¸º**ã€‚

```java
public static void main(String[] args) {
    ...
    new RaftClient(myAddress, serverAddresses);
    
    // æ³¨æ„ï¼šåº”ç”¨ç¨‹åºä¸ä¼šåœ¨æ­¤å¤„é€€å‡ºã€‚
    // RaftClientä¼šåœ¨åå°çº¿ç¨‹ä¸­ç»§ç»­è¿è¡Œã€‚
}
```

---

## 18.3 ç»“è®º ğŸ¯
*Conclusion*

### ğŸ’¡ æ˜¾è€Œæ˜“è§çš„æœ¬è´¨æ˜¯ä¿¡æ¯

æˆ‘ä»¬å¯ä»¥ä»**ä¿¡æ¯**çš„è§’åº¦æ¥æ€è€ƒ"æ˜¾è€Œæ˜“è§"ã€‚

å¦‚æœä»£ç ä¸æ˜æ˜¾ï¼Œé€šå¸¸æ„å‘³ç€è¯»è€…**ç¼ºå°‘**äº†ç†è§£å®ƒæ‰€éœ€è¦çš„**é‡è¦ä¿¡æ¯**ï¼š
- åœ¨ `Pair` çš„ä¾‹å­ä¸­ï¼Œè¯»è€…ä¸çŸ¥é“ `getKey()` è¿”å›çš„æ˜¯å½“å‰ä»»æœŸå·ã€‚
- åœ¨ `RaftClient` çš„ä¾‹å­ä¸­ï¼Œè¯»è€…ä¸çŸ¥é“æ„é€ å‡½æ•°åˆ›å»ºäº†æ–°çº¿ç¨‹ã€‚

### ğŸš€ å¦‚ä½•è®©ä»£ç æ˜¾è€Œæ˜“è§ï¼Ÿ

è¦è®©ä»£ç æ˜¾è€Œæ˜“è§ï¼Œä½ å¿…é¡»ç¡®ä¿è¯»è€…å§‹ç»ˆæ‹¥æœ‰ç†è§£å®ƒæ‰€éœ€çš„ä¿¡æ¯ã€‚æœ‰ä¸‰ç§æ–¹æ³•å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼š

**1. å‡å°‘æ‰€éœ€ä¿¡æ¯é‡ (æœ€é«˜çº§)**
- **æŠ½è±¡**ï¼šéšè—ä¸é‡è¦çš„ç»†èŠ‚ã€‚
- **æ¶ˆé™¤ç‰¹æ®Šæƒ…å†µ**ï¼šè®©ä»£ç è·¯å¾„æ›´é€šç”¨ã€‚
- è¿™æ˜¯æœ€å¥½çš„æ–¹æ³•ï¼Œä»æ ¹æœ¬ä¸Šé™ä½å¤æ‚æ€§ã€‚

**2. åˆ©ç”¨å·²æœ‰ä¿¡æ¯ (æœ€èªæ˜)**
- **éµå¾ªçº¦å®š**ï¼šåˆ©ç”¨è¯»è€…å·²æœ‰çš„çŸ¥è¯†ï¼ˆä¾‹å¦‚ï¼Œæ‰€æœ‰ `get` æ–¹æ³•éƒ½ä¸ä¼šä¿®æ”¹çŠ¶æ€ï¼‰ã€‚
- **ç¬¦åˆé¢„æœŸ**ï¼šè®©ä»£ç çš„è¡Œä¸ºç¬¦åˆæ ‡å‡†æ¨¡å¼ã€‚
- è¿™æ ·è¯»è€…å°±ä¸éœ€è¦ä¸ºä½ çš„ä»£ç å­¦ä¹ æ–°çŸ¥è¯†ã€‚

**3. æ¸…æ™°åœ°å‘ˆç°ä¿¡æ¯ (æœ€ç›´æ¥)**
- **èµ·å¥½åå­—**ï¼šåå­—æœ¬èº«å°±æ˜¯ä¿¡æ¯ã€‚
- **æˆ˜ç•¥æ€§æ³¨é‡Š**ï¼šåœ¨ä¿¡æ¯æ— æ³•é€šè¿‡ä»£ç è‡ªèº«ä¼ è¾¾æ—¶ï¼Œç”¨æ³¨é‡Šæ¥è¡¥å……ã€‚
- è¿™æ˜¯åœ¨æ— æ³•åšåˆ°å‰ä¸¤ç‚¹æ—¶çš„å¿…è¦è¡¥å……ã€‚

> **æœ€ç»ˆç›®æ ‡**ï¼šç¼–å†™çš„ä»£ç åº”è¯¥è®©è¯»è€…æ„Ÿè§‰"ç†åº”å¦‚æ­¤"ï¼Œè€Œä¸æ˜¯"è¿™æ˜¯ä»€ä¹ˆé¬¼ï¼Ÿ"ã€‚è®©æ˜¾è€Œæ˜“è§æˆä¸ºä½ ä»£ç çš„å†…åœ¨å“è´¨ã€‚

---

*"å¥½çš„ä»£ç è‡ªå·±ä¼šè¯´è¯ï¼Œè€Œæ˜¾è€Œæ˜“è§çš„ä»£ç è¯´å¾—æ¸…æ™°ã€å‡†ç¡®ã€æ¯«ä¸è´¹åŠ›ã€‚"* ğŸŒŸ 