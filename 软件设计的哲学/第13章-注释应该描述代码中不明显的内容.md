# ç¬¬13ç« ï¼šæ³¨é‡Šåº”è¯¥æè¿°ä»£ç ä¸­ä¸æ˜æ˜¾çš„å†…å®¹ - ä»"ä»£ç è‡ªè§£é‡Š"åˆ°"æ€ç»´å¤–åŒ–"çš„è®¤çŸ¥è·ƒå‡

## ğŸ­ ä»ç¬¬12ç« åˆ°ç¬¬13ç« çš„å…³é”®è½¬å˜

è¿˜è®°å¾—ç¬¬12ç« æˆ‘ä»¬ç ´é™¤çš„é‚£ä¸ªæœ€å¤§è°è¨€å—ï¼Ÿ**"å¥½çš„ä»£ç æ˜¯è‡ªè§£é‡Šçš„"**ã€‚æˆ‘ä»¬å‘ç°è¿™ä¸ªçœ‹ä¼¼åˆç†çš„è§‚ç‚¹å®é™…ä¸Šæ˜¯ç¨‹åºå‘˜æœ€å¸¸ç”¨çš„å€Ÿå£ã€‚

ç°åœ¨ç¬¬13ç« é¢ä¸´æ–°çš„æŒ‘æˆ˜ï¼š**æ—¢ç„¶è¦å†™æ³¨é‡Šï¼Œé‚£ä¹ˆæ³¨é‡Šä¸­åº”è¯¥å†™ä»€ä¹ˆï¼Ÿ**

æƒ³è±¡ä¸€ä¸ªåœºæ™¯ï¼šå…­ä¸ªæœˆåçš„ä½ çœ‹åˆ°è‡ªå·±å†™çš„ä»£ç ï¼š

```java
// ğŸ˜° æ²¡æœ‰æ³¨é‡Šçš„ä»£ç 
public void processData(List<Object> items, int threshold, boolean flag) {
    Map<String, List<Object>> groups = items.stream()
        .filter(i -> calculateScore(i) > threshold)
        .collect(groupingBy(i -> extractKey(i)));
        
    groups.forEach((k, v) -> {
        if (v.size() > 10 && flag) {
            v.subList(0, 10).forEach(this::specialProcess);
        }
    });
}
```

ä½ çš„å†…å¿ƒç‹¬ç™½ï¼š
- ğŸ¤” "thresholdæ˜¯ä»€ä¹ˆé˜ˆå€¼ï¼Ÿä¸ºä»€ä¹ˆæ˜¯è¿™ä¸ªå€¼ï¼Ÿ"
- ğŸ˜µ "è¿™ä¸ªflagæ§åˆ¶ä»€ä¹ˆï¼Ÿä»€ä¹ˆæ—¶å€™åº”è¯¥æ˜¯trueï¼Ÿ"
- ğŸ¤¯ "ä¸ºä»€ä¹ˆæ˜¯10ï¼Ÿæœ‰ä»€ä¹ˆä¸šåŠ¡å«ä¹‰ï¼Ÿ"

è¿™å°±å¼•å‡ºäº†æœ¬ç« çš„æ ¸å¿ƒé—®é¢˜ï¼š**ä»€ä¹ˆæ˜¯"ä¸æ˜æ˜¾"çš„å†…å®¹ï¼Ÿ**

## ğŸ’¡ æ ¸å¿ƒåŸåˆ™ï¼šæè¿°ä¸æ˜æ˜¾çš„å†…å®¹

> **é‡‘ç§‘ç‰å¾‹**ï¼šæ³¨é‡Šåº”è¯¥æè¿°ä»£ç ä¸­ä¸æ˜æ˜¾çš„å†…å®¹ã€‚

### ä¸‰ç±»ä¸æ˜æ˜¾çš„å†…å®¹

1. **åº•å±‚ç»†èŠ‚**ï¼šç²¾ç¡®çš„å•ä½ã€è¾¹ç•Œæ¡ä»¶ã€nullå€¼å¤„ç†ç­‰
2. **ä»£ç å­˜åœ¨çš„åŸå› **ï¼šä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿä¸ºä»€ä¹ˆä¸ç”¨å…¶ä»–æ–¹æ³•ï¼Ÿ
3. **éšå«çš„ä¾èµ–å’Œè§„åˆ™**ï¼šè°ƒç”¨é¡ºåºã€å…¨å±€çº¦æŸç­‰

### æŠ½è±¡æ˜¯æœ€é‡è¦çš„ä¸æ˜æ˜¾ä¿¡æ¯

> "æ³¨é‡Šçš„æœ€é‡è¦åŸå› ä¹‹ä¸€æ˜¯æŠ½è±¡...ä»£ç æ˜¯å¦‚æ­¤è¯¦ç»†ï¼Œä»¥è‡³äºä»…é€šè¿‡é˜…è¯»ä»£ç å°±å¾ˆéš¾çœ‹åˆ°æŠ½è±¡ã€‚"

```java
// âœ¨ åŠ ä¸ŠæŠ½è±¡å±‚é¢çš„æ³¨é‡Šå
/**
 * å¤„ç†ç”¨æˆ·è¯„è®ºï¼Œç­›é€‰é«˜è´¨é‡è¯„è®ºå¹¶è¿›è¡Œç²¾é€‰æ¨è
 * 
 * ä¸šåŠ¡èƒŒæ™¯ï¼šä¸ºäº†æå‡ç”¨æˆ·ä½“éªŒï¼Œæˆ‘ä»¬éœ€è¦ä»æµ·é‡è¯„è®ºä¸­ç­›é€‰å‡º
 * é«˜è´¨é‡çš„è¯„è®ºè¿›è¡Œç²¾é€‰æ¨è
 * 
 * @param items å¾…å¤„ç†çš„ç”¨æˆ·è¯„è®ºåˆ—è¡¨
 * @param qualityThreshold è¯„è®ºè´¨é‡é˜ˆå€¼ï¼ˆåŸºäºç‚¹èµæ•°ã€å›å¤æ•°ç­‰è®¡ç®—ï¼‰
 * @param enableSampling æ˜¯å¦å¯ç”¨é‡‡æ ·ï¼ˆé«˜å³°æœŸé™åˆ¶å¤„ç†é‡ï¼‰
 */
public void processHighQualityComments(List<Comment> items, int qualityThreshold, boolean enableSampling) {
    // æŒ‰ä½œè€…åˆ†ç»„ï¼Œç­›é€‰é«˜è´¨é‡è¯„è®º
    Map<String, List<Comment>> commentsByAuthor = items.stream()
        .filter(comment -> comment.getQualityScore() > qualityThreshold)
        .collect(groupingBy(comment -> comment.getAuthorId()));
        
    commentsByAuthor.forEach((authorId, comments) -> {
        // é™åˆ¶æ¯ä¸ªä½œè€…æœ€å¤šæ¨è10æ¡è¯„è®ºï¼Œé¿å…åˆ·å±
        // é«˜å³°æœŸå¯ç”¨é‡‡æ ·ä»¥æ§åˆ¶ç³»ç»Ÿè´Ÿè½½
        if (comments.size() > 10 && enableSampling) {
            comments.subList(0, 10).forEach(this::addToRecommendationPool);
        }
    });
}
```

## ğŸ“‹ 13.1 é€‰æ‹©çº¦å®šï¼šå»ºç«‹å›¢é˜Ÿæ ‡å‡†

ä»ç¬¬12ç« çš„è§‰é†’åˆ°ç¬¬13ç« çš„å®è·µï¼Œæˆ‘ä»¬éœ€è¦ä»æ··ä¹±èµ°å‘æœ‰åºï¼Œå»ºç«‹æ˜ç¡®çš„æ³¨é‡Šçº¦å®šã€‚

### çº¦å®šçš„ä¸¤ä¸ªé‡è¦ç›®çš„

1. **ç¡®ä¿ä¸€è‡´æ€§**ï¼šè®©æ³¨é‡Šæ›´æ˜“äºé˜…è¯»å’Œç†è§£
2. **ç¡®ä¿å®é™…å†™æ³¨é‡Š**ï¼šæœ‰æ˜ç¡®è§„èŒƒå°±ä¸ä¼šå¿˜è®°å†™

### å››ç§æ³¨é‡Šç±»åˆ«çš„ä¼˜å…ˆçº§

æ ¹æ®John Ousterhoutçš„ç ”ç©¶ï¼Œæ³¨é‡Šå¯ä»¥åˆ†ä¸ºå››ç±»ï¼ŒæŒ‰é‡è¦æ€§æ’åºï¼š

#### 1. Interfaceï¼ˆæ¥å£æ³¨é‡Šï¼‰â­â­â­â­â­ - æœ€é‡è¦
```java
/**
 * ç”¨æˆ·ç®¡ç†æœåŠ¡ - æ ¸å¿ƒç”¨æˆ·ç”Ÿå‘½å‘¨æœŸç®¡ç†
 * 
 * è¿™ä¸ªç±»æä¾›äº†ç”¨æˆ·ä»æ³¨å†Œåˆ°åˆ é™¤çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚
 * å®ƒæ˜¯ç”¨æˆ·ç›¸å…³åŠŸèƒ½çš„æ ¸å¿ƒæŠ½è±¡ï¼Œæ‰€æœ‰ç”¨æˆ·æ“ä½œéƒ½åº”è¯¥é€šè¿‡è¿™ä¸ªæ¥å£ã€‚
 * 
 * é‡è¦è®¾è®¡åŸåˆ™ï¼š
 * - æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯äº‹åŠ¡æ€§çš„ï¼šè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥
 * - æ‰€æœ‰æ“ä½œéƒ½ä¼šè®°å½•å®¡è®¡æ—¥å¿—
 * - æ‰€æœ‰å¯†ç ç›¸å…³æ“ä½œéƒ½ä¼šè¿›è¡Œå¼ºåŠ å¯†
 */
public interface UserService {
    /**
     * åˆ›å»ºæ–°ç”¨æˆ·è´¦æˆ·
     * 
     * è¿™ä¸ªæ–¹æ³•å¯åŠ¨å®Œæ•´çš„ç”¨æˆ·å¼•å¯¼æµç¨‹ï¼šéªŒè¯ä¿¡æ¯ã€åˆ›å»ºè´¦æˆ·ã€
     * å‘é€æ¬¢è¿é‚®ä»¶ã€åˆå§‹åŒ–åå¥½è®¾ç½®ã€è§¦å‘ç”¨æˆ·ç”»åƒåˆ†æï¼ˆå¼‚æ­¥ï¼‰
     * 
     * @param userInfo ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ï¼Œé‚®ç®±å­—æ®µå¿…é¡»å”¯ä¸€ä¸”æœ‰æ•ˆ
     * @return åˆ›å»ºçš„ç”¨æˆ·å¯¹è±¡ï¼ŒåŒ…å«ç³»ç»Ÿç”Ÿæˆçš„IDå’Œæ—¶é—´æˆ³
     * @throws DuplicateEmailException é‚®ç®±å·²è¢«æ³¨å†Œ
     * @throws InvalidUserDataException ç”¨æˆ·ä¿¡æ¯ä¸ç¬¦åˆè¦æ±‚
     */
    User createUser(UserRegistrationInfo userInfo) throws DuplicateEmailException, InvalidUserDataException;
}
```

#### 2. Data structure memberï¼ˆæ•°æ®ç»“æ„æˆå‘˜ï¼‰â­â­â­â­ - å¾ˆé‡è¦
```java
public class OrderStatus {
    /**
     * è®¢å•åˆ›å»ºæ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰
     * 
     * è¿™æ˜¯è®¢å•åœ¨ç³»ç»Ÿä¸­çš„åˆ›å»ºæ—¶é—´ï¼Œä¸æ˜¯ç”¨æˆ·ä¸‹å•æ—¶é—´ã€‚
     * ç”¨æˆ·ä¸‹å•æ—¶é—´å¯èƒ½å› ä¸ºç½‘ç»œå»¶è¿Ÿã€ç³»ç»Ÿå¤„ç†ç­‰åŸå› ä¸æ­¤æ—¶é—´æœ‰å·®å¼‚ã€‚
     * 
     * æ—¶åŒºï¼šUTC+8ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰
     * ç”¨é€”ï¼šç”¨äºè®¢å•è¶…æ—¶è®¡ç®—ã€ç»Ÿè®¡åˆ†æã€å®¡è®¡è¿½è¸ª
     * 
     * æ³¨æ„ï¼šè¿™ä¸ªæ—¶é—´æ˜¯ä¸å¯å˜çš„ï¼Œåˆ›å»ºåä¸ä¼šæ›´æ–°
     */
    private long createdTimestamp;
    
    /**
     * è®¢å•çŠ¶æ€æšä¸¾
     * 
     * çŠ¶æ€æµè½¬è§„åˆ™ï¼š
     * PENDING -> PAID -> SHIPPED -> DELIVERED -> COMPLETED
     * ä»»ä½•çŠ¶æ€éƒ½å¯ä»¥è½¬æ¢ä¸º CANCELLED æˆ– REFUNDED
     * 
     * ä¸šåŠ¡å«ä¹‰ï¼š
     * - PENDING: ç­‰å¾…æ”¯ä»˜ï¼Œè¶…æ—¶30åˆ†é’Ÿè‡ªåŠ¨å–æ¶ˆ
     * - PAID: å·²æ”¯ä»˜ï¼Œç­‰å¾…å‘è´§ï¼Œ24å°æ—¶å†…å¿…é¡»å‘è´§
     * - SHIPPED: å·²å‘è´§ï¼Œç‰©æµä¿¡æ¯å·²æ›´æ–°
     * - DELIVERED: å·²é€è¾¾ï¼Œç­‰å¾…ç”¨æˆ·ç¡®è®¤æ”¶è´§
     * - COMPLETED: äº¤æ˜“å®Œæˆï¼Œä¸å¯æ’¤é”€
     * - CANCELLED: å·²å–æ¶ˆï¼Œå¦‚æœå·²æ”¯ä»˜åˆ™è‡ªåŠ¨é€€æ¬¾
     * - REFUNDED: å·²é€€æ¬¾ï¼Œé€€æ¬¾é‡‘é¢å·²è¿”è¿˜ç”¨æˆ·è´¦æˆ·
     */
    private OrderStatusEnum status;
    
    /**
     * ä¹è§‚é”ç‰ˆæœ¬å·
     * 
     * ç”¨äºé˜²æ­¢å¹¶å‘ä¿®æ”¹å†²çªã€‚æ¯æ¬¡æ›´æ–°è®¢å•æ—¶ç‰ˆæœ¬å·+1ã€‚
     * å¦‚æœæ›´æ–°æ—¶ç‰ˆæœ¬å·ä¸åŒ¹é…ï¼Œè¯´æ˜è®¢å•å·²è¢«å…¶ä»–æ“ä½œä¿®æ”¹ï¼Œ
     * éœ€è¦é‡æ–°è¯»å–æœ€æ–°æ•°æ®åå†å°è¯•æ›´æ–°ã€‚
     * 
     * åˆå§‹å€¼ï¼š0
     * æ›´æ–°ç­–ç•¥ï¼šæ¯æ¬¡å†™æ“ä½œè‡ªåŠ¨é€’å¢
     * 
     * æ³¨æ„ï¼šè¿™ä¸ªå­—æ®µå¯¹ä¸šåŠ¡é€»è¾‘é€æ˜ï¼Œåªç”¨äºå¹¶å‘æ§åˆ¶
     */
    private int version;
}
```

#### 3. Implementationï¼ˆå®ç°æ³¨é‡Šï¼‰â­â­â­ - é€‚åº¦ä½¿ç”¨
```java
public class PaymentProcessor {
    public void processPayment(PaymentRequest request) {
        // é¢„æˆæƒæ£€æŸ¥ï¼šé¿å…æ— æ•ˆæ”¯ä»˜è¯·æ±‚å ç”¨ç³»ç»Ÿèµ„æº
        // è¿™é‡ŒåªåšåŸºæœ¬éªŒè¯ï¼Œè¯¦ç»†éªŒè¯åœ¨æ”¯ä»˜ç½‘å…³è¿›è¡Œ
        if (!isValidPaymentRequest(request)) {
            throw new InvalidPaymentException("æ”¯ä»˜è¯·æ±‚æ ¼å¼é”™è¯¯");
        }
        
        // é£æ§æ£€æŸ¥ï¼šåŸºäºç”¨æˆ·å†å²è¡Œä¸ºå’Œå½“å‰äº¤æ˜“ç‰¹å¾
        // å¦‚æœé£é™©è¯„åˆ† > 80ï¼Œéœ€è¦é¢å¤–éªŒè¯ï¼ˆçŸ­ä¿¡éªŒè¯ç ï¼‰
        // å¦‚æœé£é™©è¯„åˆ† > 90ï¼Œç›´æ¥æ‹’ç»äº¤æ˜“
        RiskScore riskScore = riskEngine.evaluate(request);
        if (riskScore.getScore() > 90) {
            logSecurityEvent(request, "é«˜é£é™©äº¤æ˜“è¢«æ‹’ç»");
            throw new HighRiskTransactionException("äº¤æ˜“é£é™©è¿‡é«˜");
        }
        
        // æ”¯ä»˜å¤„ç†ï¼šè¿™é‡Œä½¿ç”¨å¼‚æ­¥æ–¹å¼å¤„ç†
        // åŸå› ï¼šæ”¯ä»˜ç½‘å…³å“åº”æ—¶é—´ä¸ç¨³å®šï¼ˆ1-10ç§’ï¼‰ï¼Œå¼‚æ­¥å¤„ç†é¿å…é˜»å¡
        // ç»“æœé€šè¿‡å›è°ƒæ¥å£å¼‚æ­¥è¿”å›
        PaymentJobId jobId = paymentGateway.submitPaymentAsync(request);
        
        // çŠ¶æ€è¿½è¸ªï¼šè®°å½•æ”¯ä»˜ä»»åŠ¡ï¼Œç”¨äºåç»­çŠ¶æ€æŸ¥è¯¢å’Œå¼‚å¸¸å¤„ç†
        paymentJobRepository.save(new PaymentJob(jobId, request.getOrderId()));
    }
}
```

#### 4. Cross-moduleï¼ˆè·¨æ¨¡å—æ³¨é‡Šï¼‰â­â­ - ç¨€æœ‰ä½†å…³é”®
```java
public class OrderService {
    /**
     * å¤„ç†è®¢å•å–æ¶ˆé€»è¾‘
     * 
     * è·¨æ¨¡å—å½±å“åˆ†æï¼š
     * 
     * 1. åº“å­˜æœåŠ¡ (InventoryService)ï¼š
     *    - éœ€è¦é‡Šæ”¾å·²é¢„å çš„åº“å­˜
     *    - å¦‚æœåº“å­˜é‡Šæ”¾å¤±è´¥ï¼Œè®¢å•çŠ¶æ€ä¿æŒä¸º"å–æ¶ˆä¸­"
     *    - ä¼šè§¦å‘åº“å­˜é¢„è­¦é‡æ–°è®¡ç®—
     * 
     * 2. æ”¯ä»˜æœåŠ¡ (PaymentService)ï¼š
     *    - å¦‚æœå·²æ”¯ä»˜ï¼Œéœ€è¦å‘èµ·é€€æ¬¾æµç¨‹
     *    - é€€æ¬¾æ˜¯å¼‚æ­¥çš„ï¼Œå¯èƒ½éœ€è¦1-3ä¸ªå·¥ä½œæ—¥
     *    - é€€æ¬¾å¤±è´¥ä¼šè§¦å‘äººå·¥å¤„ç†æµç¨‹
     * 
     * 3. ç‰©æµæœåŠ¡ (LogisticsService)ï¼š
     *    - å¦‚æœå·²å‘è´§ï¼Œéœ€è¦å‘èµ·é€€è´§æµç¨‹
     *    - é€€è´§ç‰©æµè´¹ç”¨å¤„ç†è§„åˆ™å¤æ‚ï¼Œéœ€è¦è°ƒç”¨è´¹ç”¨è®¡ç®—æœåŠ¡
     * 
     * 4. ç”¨æˆ·æœåŠ¡ (UserService)ï¼š
     *    - éœ€è¦å‘é€è®¢å•å–æ¶ˆé€šçŸ¥
     *    - æ›´æ–°ç”¨æˆ·ä¿¡èª‰åº¦è¯„åˆ†
     *    - é¢‘ç¹å–æ¶ˆè®¢å•å¯èƒ½è§¦å‘é£æ§å®¡æ ¸
     * 
     * å¼‚å¸¸å¤„ç†ç­–ç•¥ï¼š
     * - æ ¸å¿ƒæ“ä½œï¼ˆåº“å­˜é‡Šæ”¾ã€æ”¯ä»˜é€€æ¬¾ï¼‰å¤±è´¥æ—¶ï¼Œè®¢å•è¿›å…¥"å¼‚å¸¸"çŠ¶æ€
     * - è¾…åŠ©æ“ä½œï¼ˆé€šçŸ¥å‘é€ã€æ•°æ®ç»Ÿè®¡ï¼‰å¤±è´¥æ—¶ï¼Œè®°å½•é”™è¯¯ä½†ä¸å½±å“ä¸»æµç¨‹
     * - æ‰€æœ‰è·¨æ¨¡å—è°ƒç”¨éƒ½æœ‰è¶…æ—¶å’Œé‡è¯•æœºåˆ¶
     */
    public void cancelOrder(Long orderId) {
        // å¤æ‚çš„è·¨æ¨¡å—åè°ƒé€»è¾‘...
    }
}
```

> **åŸæ–‡å¼ºè°ƒ**ï¼šå‰ä¸¤ç§æ³¨é‡Šæœ€é‡è¦ã€‚æ¯ä¸ªç±»ã€æ¯ä¸ªç±»å˜é‡ã€æ¯ä¸ªæ–¹æ³•éƒ½åº”è¯¥æœ‰æ³¨é‡Šã€‚

## ğŸš© 13.2 ä¸è¦é‡å¤ä»£ç ï¼šæœ€è‡´å‘½çš„æ³¨é‡Šåæ¨¡å¼

### åˆ¤æ–­æ ‡å‡†ï¼šé»„é‡‘æµ‹è¯•æ³•åˆ™

> "ä»æœªçœ‹è¿‡ä»£ç çš„äººèƒ½å¦ä»…é€šè¿‡æŸ¥çœ‹æ³¨é‡Šæ—è¾¹çš„ä»£ç æ¥å†™å‡ºè¿™æ ·çš„æ³¨é‡Šï¼Ÿå¦‚æœç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œåˆ™æ³¨é‡Šä¸ä¼šä½¿ä»£ç æ›´æ˜“äºç†è§£ã€‚"

### å…¸å‹çš„é‡å¤æ³¨é‡Šç¤ºä¾‹

```java
// âŒ å®Œå…¨é‡å¤ä»£ç 
// Add a horizontal scroll bar
hScrollBar = new JScrollBar(JScrollBar.HORIZONTAL);
add(hScrollBar, BorderLayout.SOUTH);

// âŒ åªæ˜¯é‡å¤æ–¹æ³•å
/*
 * Obtain a normalized resource name from REQ.
 */
private static String[] getNormalizedResourceNames(HTTPRequest req) {...}
```

### æ”¹è¿›ç­–ç•¥ï¼šä½¿ç”¨ä¸åŒçš„è¯æ±‡å’Œå±‚æ¬¡

```java
// âŒ é‡å¤è¯æ±‡
/*
 * The horizontal padding of each line in the text.
 */
private static final int textHorizontalPadding = 4;

// âœ… æä¾›é¢å¤–ä¿¡æ¯
/*
 * The amount of blank space to leave on the left and
 * right sides of each line of text, in pixels.
 * 
 * This spacing ensures text doesn't touch the container edges,
 * improving readability especially on mobile devices.
 */
private static final int textHorizontalPadding = 4;
```

### é‡å¤æ³¨é‡Šçš„å±å®³

1. **ä¿¡æ¯å™ªå£°**ï¼šå¤§é‡æ— æ•ˆæ³¨é‡Šé™ä½äº†æœ‰ç”¨ä¿¡æ¯çš„å¯†åº¦
2. **ç»´æŠ¤è´Ÿæ‹…**ï¼šæ¯æ¬¡ä¿®æ”¹ä»£ç éƒ½éœ€è¦ä¿®æ”¹æ³¨é‡Šï¼Œå¦åˆ™äº§ç”Ÿä¸ä¸€è‡´
3. **è¯¯å¯¼è¯»è€…**ï¼šè®©è¯»è€…ä»¥ä¸ºæ‰€æœ‰æ³¨é‡Šéƒ½æ˜¯æ— ç”¨çš„ï¼Œå¿½ç•¥çœŸæ­£æœ‰ä»·å€¼çš„æ³¨é‡Š

## ğŸ” 13.3 ä½çº§æ³¨é‡Šå¢åŠ ç²¾åº¦

### é€‚ç”¨åœºæ™¯
ç²¾åº¦åœ¨æ³¨é‡Šå˜é‡å£°æ˜æ—¶æœ€æœ‰ç”¨ï¼šç±»å®ä¾‹å˜é‡ã€æ–¹æ³•å‚æ•°ã€è¿”å›å€¼ã€‚

### éœ€è¦æ¾„æ¸…çš„5ä¸ªå…³é”®é—®é¢˜

1. **å•ä½**ï¼šæ­¤å˜é‡çš„å•ä½æ˜¯ä»€ä¹ˆï¼Ÿ
2. **è¾¹ç•Œæ¡ä»¶**ï¼šæ˜¯åŒ…å«è¿˜æ˜¯æ’é™¤ï¼Ÿ
3. **ç©ºå€¼å«ä¹‰**ï¼šå¦‚æœå…è®¸nullï¼Œæ„å‘³ç€ä»€ä¹ˆï¼Ÿ
4. **èµ„æºç®¡ç†**ï¼šè°è´Ÿè´£é‡Šæ”¾æˆ–å…³é—­èµ„æºï¼Ÿ
5. **ä¸å˜é‡**ï¼šæ˜¯å¦æœ‰å§‹ç»ˆä¸ºçœŸçš„å±æ€§ï¼Ÿ

### å®æˆ˜å¯¹æ¯”ç¤ºä¾‹

```java
// âŒ å¤ªæ¨¡ç³Š
// Current offset in resp Buffer
uint32_t offset;

// Contains all line-widths inside the document and
// number of appearances.
private TreeMap<Integer, Integer> lineWidths;

// âœ… ç²¾ç¡®æè¿°
// Position in this buffer of the first object that hasn't
// been returned to the client.
uint32_t offset;

// Holds statistics about line lengths of the form <length, count>
// where length is the number of characters in a line (including
// the newline), and count is the number of lines with
// exactly that many characters. If there are no lines with
// a particular length, then there is no entry for that length.
private TreeMap<Integer, Integer> numLinesWithLength;
```

### å®é™…åº”ç”¨ç¤ºä¾‹

```java
// âŒ ç¼ºå°‘ç²¾ç¡®æ€§ä¿¡æ¯
public void processPayment(double amount, String currency) {
    // å¤„ç†æ”¯ä»˜
}

// âœ… æä¾›ç²¾ç¡®æ€§ä¿¡æ¯
/**
 * å¤„ç†æ”¯ä»˜è¯·æ±‚
 * 
 * æ•°æ®ç²¾åº¦è¦æ±‚ï¼š
 * @param amount æ”¯ä»˜é‡‘é¢ï¼Œå•ä½ï¼šåˆ†ï¼ˆé¿å…æµ®ç‚¹ç²¾åº¦é—®é¢˜ï¼‰
 *               æœ‰æ•ˆèŒƒå›´ï¼š1-999999999ï¼ˆ1åˆ†åˆ°999ä¸‡å…ƒï¼‰
 * @param currency è´§å¸ä»£ç ï¼Œéµå¾ªISO 4217æ ‡å‡†ï¼ˆå¦‚"CNY", "USD"ï¼‰
 *                 å½“å‰æ”¯æŒï¼šCNY, USD, EUR, GBP
 * 
 * è¾¹ç•Œæ¡ä»¶ï¼š
 * - amount <= 0 æ—¶æŠ›å‡ºIllegalArgumentException
 * - ä¸æ”¯æŒçš„currencyæ—¶æŠ›å‡ºUnsupportedCurrencyException
 * - å•æ—¥ç´¯è®¡æ”¯ä»˜é¢åº¦é™åˆ¶ï¼š10ä¸‡å…ƒ
 * 
 * ç©ºå€¼å¤„ç†ï¼š
 * - amountä¸ºnullæ—¶ä½¿ç”¨é»˜è®¤å€¼0ï¼ˆä¼šè§¦å‘å¼‚å¸¸ï¼‰
 * - currencyä¸ºnullæ—¶é»˜è®¤ä½¿ç”¨"CNY"
 */
public void processPayment(BigDecimal amount, String currency) {
    // å¤„ç†æ”¯ä»˜
}
```

### å…³é”®åŸåˆ™ï¼šåè¯è€ŒéåŠ¨è¯

> "åœ¨ä¸ºå˜é‡æ·»åŠ æ³¨é‡Šæ—¶ï¼Œè¯·è€ƒè™‘ä½¿ç”¨åè¯è€Œä¸æ˜¯åŠ¨è¯ã€‚æ¢å¥è¯è¯´ï¼Œå…³æ³¨å˜é‡ä»£è¡¨ä»€ä¹ˆï¼Œè€Œä¸æ˜¯å¦‚ä½•è¢«æ“çºµã€‚"

## ğŸ¯ 13.4 é«˜çº§æ³¨é‡Šå¢å¼ºç›´è§‰

### ä½œç”¨ï¼šæä¾›æ¦‚å¿µæ¡†æ¶

é«˜çº§æ³¨é‡Šå†™åœ¨æ¯”ä»£ç æ›´é«˜çš„å±‚æ¬¡ï¼Œå¿½ç•¥ç»†èŠ‚ï¼Œå¸®åŠ©è¯»è€…ç†è§£ä»£ç çš„æ•´ä½“æ„å›¾å’Œç»“æ„ã€‚

### ç»å…¸å¯¹æ¯”ä¾‹å­

```java
// âŒ å¤ªä½çº§ï¼Œéƒ¨åˆ†é‡å¤ä»£ç 
// If there is a LOADING readRpc using the same session
// as PKHash pointed to by assignPos, and the last PKHash
// in that readRPC is smaller than current assigning
// PKHash, then we put assigning PKHash into that readRPC.

// âœ… é«˜çº§æŠ½è±¡ï¼Œæä¾›æ¦‚å¿µæ¡†æ¶
// Try to append the current key hash onto an existing
// RPC to the desired server that hasn't been sent yet.
```

### å†™ä½œæŠ€å·§ï¼šå›ç­”ä¸‰ä¸ªå…³é”®é—®é¢˜

> "é—®é—®è‡ªå·±ï¼šè¿™æ®µä»£ç è¦åšä»€ä¹ˆï¼Ÿæ‚¨èƒ½ä»¥ä½•ç§æœ€ç®€å•æ–¹å¼æ¥è§£é‡Šä»£ç ä¸­çš„æ‰€æœ‰å†…å®¹ï¼Ÿè¿™æ®µä»£ç æœ€é‡è¦çš„æ˜¯ä»€ä¹ˆï¼Ÿ"

### å®é™…åº”ç”¨ç¤ºä¾‹

```java
public class RecommendationEngine {
    public void optimizeRecommendations(UserProfile profile) {
        /*
         * ä¸ªæ€§åŒ–æ¨èä¼˜åŒ–ç®—æ³•
         * 
         * æ ¸å¿ƒæ€è·¯ï¼šå¹³è¡¡ç”¨æˆ·å…´è¶£çš„å¤šæ ·æ€§å’Œå‡†ç¡®æ€§
         * - 70%åŸºäºç”¨æˆ·å†å²åå¥½ï¼ˆå‡†ç¡®æ€§ï¼‰
         * - 20%åŸºäºç›¸ä¼¼ç”¨æˆ·è¡Œä¸ºï¼ˆå‘ç°æ€§ï¼‰
         * - 10%åŸºäºçƒ­é—¨è¶‹åŠ¿ï¼ˆæ—¶æ•ˆæ€§ï¼‰
         * 
         * è¿™ä¸ªæ¯”ä¾‹ç»è¿‡A/Bæµ‹è¯•éªŒè¯ï¼Œèƒ½æœ€å¤§åŒ–ç”¨æˆ·ç‚¹å‡»ç‡
         */
        
        // å…·ä½“å®ç°ç»†èŠ‚...
        List<Item> historicalItems = getHistoricalPreferences(profile);
        List<Item> similarUserItems = getSimilarUserBehavior(profile);
        List<Item> trendingItems = getTrendingItems();
        
        // æŒ‰æƒé‡æ··åˆæ¨èç»“æœ
        List<Item> recommendations = mixRecommendations(
            historicalItems, 0.7,
            similarUserItems, 0.2,
            trendingItems, 0.1
        );
    }
}
```

### é«˜çº§æ³¨é‡Šçš„ä»·å€¼

- æä¾›ä¸šåŠ¡èƒŒæ™¯å’Œè®¾è®¡æ„å›¾
- è§£é‡Šç®—æ³•é€‰æ‹©çš„åŸå› 
- æè¿°æ•´ä½“æ¶æ„æ€è·¯
- å¸®åŠ©è¯»è€…å¿«é€Ÿç†è§£å¤æ‚é€»è¾‘

## ğŸ“š 13.5 æ¥å£æ–‡æ¡£ï¼šå®šä¹‰æŠ½è±¡çš„è‰ºæœ¯

### æ¥å£æ³¨é‡Šçš„æ ¸å¿ƒä½œç”¨

> "æ³¨é‡Šæœ€é‡è¦çš„ä½œç”¨ä¹‹ä¸€å°±æ˜¯å®šä¹‰æŠ½è±¡...ä»£ç ä¸é€‚åˆæè¿°æŠ½è±¡...æè¿°æŠ½è±¡çš„å”¯ä¸€æ–¹æ³•æ˜¯ä½¿ç”¨æ³¨é‡Šã€‚"

### åˆ†ç¦»åŸåˆ™ï¼šæ¥å£ vs å®ç°

- **æ¥å£æ³¨é‡Š**ï¼šä½¿ç”¨ç±»æˆ–æ–¹æ³•éœ€è¦çŸ¥é“çš„ä¿¡æ¯ï¼ˆå®šä¹‰æŠ½è±¡ï¼‰
- **å®ç°æ³¨é‡Š**ï¼šç±»æˆ–æ–¹æ³•å†…éƒ¨å¦‚ä½•å·¥ä½œï¼ˆå®ç°æŠ½è±¡ï¼‰

> **é‡è¦**ï¼šå¦‚æœæ¥å£æ³¨é‡Šä¹Ÿå¿…é¡»æè¿°å®ç°ï¼Œåˆ™è¯¥ç±»æˆ–æ–¹æ³•å¾ˆæµ…ã€‚

### ç±»çš„æ¥å£æ³¨é‡Š

```java
/**
 * åˆ†å¸ƒå¼ç¼“å­˜ç®¡ç†å™¨ - é«˜æ€§èƒ½å¤šçº§ç¼“å­˜è§£å†³æ–¹æ¡ˆ
 * 
 * è¿™ä¸ªç±»æä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„ç¼“å­˜æ¥å£ï¼Œå†…éƒ¨ç®¡ç†å¤šçº§ç¼“å­˜å±‚æ¬¡ï¼š
 * - L1: æœ¬åœ°å†…å­˜ç¼“å­˜ï¼ˆæœ€å¿«ï¼Œå®¹é‡å°ï¼‰
 * - L2: æœ¬åœ°ç£ç›˜ç¼“å­˜ï¼ˆä¸­ç­‰é€Ÿåº¦ï¼Œå®¹é‡ä¸­ç­‰ï¼‰
 * - L3: åˆ†å¸ƒå¼Redisç¼“å­˜ï¼ˆè¾ƒæ…¢ï¼Œå®¹é‡å¤§ï¼‰
 * 
 * ç¼“å­˜ç­–ç•¥ï¼š
 * - è¯»å–ï¼šæŒ‰L1->L2->L3é¡ºåºæŸ¥æ‰¾ï¼Œæ‰¾åˆ°åå›å¡«ä¸Šå±‚ç¼“å­˜
 * - å†™å…¥ï¼šåŒæ—¶å†™å…¥æ‰€æœ‰å±‚æ¬¡ï¼Œä¿è¯ä¸€è‡´æ€§
 * - æ·˜æ±°ï¼šLRUç®—æ³•ï¼Œè‡ªåŠ¨ç®¡ç†å†…å­˜ä½¿ç”¨
 * 
 * æ€§èƒ½ç‰¹å¾ï¼š
 * - ç¼“å­˜å‘½ä¸­ç‡ï¼š>90%ï¼ˆç”Ÿäº§ç¯å¢ƒç»Ÿè®¡ï¼‰
 * - å¹³å‡å“åº”æ—¶é—´ï¼š<10msï¼ˆ99%çš„è¯·æ±‚ï¼‰
 * - æ”¯æŒå¹¶å‘ï¼š1000+ QPS
 * 
 * ä½¿ç”¨åœºæ™¯ï¼š
 * - é€‚ç”¨äºè¯»å¤šå†™å°‘çš„åœºæ™¯
 * - æ•°æ®ä¸€è‡´æ€§è¦æ±‚ä¸æ˜¯æå…¶ä¸¥æ ¼
 * - éœ€è¦é«˜æ€§èƒ½æ•°æ®è®¿é—®
 */
public class DistributedCacheManager {
    // å®ç°ç»†èŠ‚...
}
```

### æ–¹æ³•çš„æ¥å£æ³¨é‡Šï¼š5ä¸ªå¿…å¤‡è¦ç´ 

1. **è¡Œä¸ºæè¿°**ï¼ˆé«˜çº§æŠ½è±¡ï¼‰
2. **å‚æ•°å’Œè¿”å›å€¼**ï¼ˆå¿…é¡»ç²¾ç¡®ï¼‰
3. **å‰¯ä½œç”¨**ï¼ˆå½±å“ç³»ç»Ÿæœªæ¥è¡Œä¸ºï¼‰
4. **å¼‚å¸¸**ï¼ˆå¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸ï¼‰
5. **å‰ç½®æ¡ä»¶**ï¼ˆè°ƒç”¨å‰å¿…é¡»æ»¡è¶³çš„æ¡ä»¶ï¼‰

### å®æˆ˜ç¤ºä¾‹

```java
/**
 * å¤„ç†æ”¯ä»˜è¯·æ±‚å¹¶æ›´æ–°è®¢å•çŠ¶æ€
 * 
 * è¿™ä¸ªæ–¹æ³•æ‰§è¡Œå®Œæ•´çš„æ”¯ä»˜æµç¨‹ï¼ŒåŒ…æ‹¬é£æ§æ£€æŸ¥ã€æ”¯ä»˜å¤„ç†å’ŒçŠ¶æ€æ›´æ–°ã€‚
 * æ”¯ä»˜è¿‡ç¨‹æ˜¯å¼‚æ­¥çš„ï¼Œç»“æœé€šè¿‡å›è°ƒæ¥å£è¿”å›ã€‚
 * 
 * å‰¯ä½œç”¨ï¼š
 * - æ›´æ–°è®¢å•çŠ¶æ€ä¸º"æ”¯ä»˜ä¸­"
 * - è®°å½•æ”¯ä»˜æ—¥å¿—ç”¨äºå®¡è®¡
 * - å‘é€æ”¯ä»˜ç¡®è®¤é‚®ä»¶
 * - æ‰£å‡ç”¨æˆ·è´¦æˆ·ä½™é¢ï¼ˆå¦‚æœä½¿ç”¨é’±åŒ…æ”¯ä»˜ï¼‰
 * 
 * @param paymentRequest æ”¯ä»˜è¯·æ±‚ï¼Œå¿…é¡»åŒ…å«æœ‰æ•ˆçš„è®¢å•IDå’Œé‡‘é¢
 * @return æ”¯ä»˜ä»»åŠ¡IDï¼Œç”¨äºåç»­çŠ¶æ€æŸ¥è¯¢
 * @throws InvalidPaymentException æ”¯ä»˜è¯·æ±‚æ ¼å¼é”™è¯¯æˆ–é‡‘é¢ä¸åŒ¹é…
 * @throws InsufficientFundsException è´¦æˆ·ä½™é¢ä¸è¶³
 * @throws RiskControlException é£æ§æ£€æŸ¥æœªé€šè¿‡
 * 
 * å‰ç½®æ¡ä»¶ï¼š
 * - è®¢å•å¿…é¡»å¤„äº"å¾…æ”¯ä»˜"çŠ¶æ€
 * - ç”¨æˆ·å¿…é¡»å·²é€šè¿‡å®åè®¤è¯
 * - æ”¯ä»˜é‡‘é¢å¿…é¡»åœ¨å•ç¬”é™é¢å†…
 */
public PaymentJobId processPayment(PaymentRequest paymentRequest) 
        throws InvalidPaymentException, InsufficientFundsException, RiskControlException {
    // å®ç°ç»†èŠ‚...
}
```

### ğŸš© çº¢æ——è­¦å‘Šï¼šå®ç°æ–‡æ¡£æ±¡æŸ“æ¥å£

> "å½“æ¥å£æ–‡æ¡£è®°å½•äº†ä½¿ç”¨è¿‡ç¨‹ä¸­ä¸éœ€è¦çŸ¥é“çš„å®ç°çš„è¯¦ç»†ä¿¡æ¯æ—¶ï¼Œå°±ä¼šå‡ºç°æ­¤çº¢è‰²æ ‡è®°ã€‚"

```java
// âŒ æ¥å£æ³¨é‡ŠåŒ…å«å®ç°ç»†èŠ‚
/**
 * ä¿å­˜ç”¨æˆ·ä¿¡æ¯
 * 
 * å®ç°ç»†èŠ‚ï¼š
 * - ä½¿ç”¨MySQLæ•°æ®åº“çš„usersè¡¨
 * - å¯†ç ä½¿ç”¨BCryptåŠ å¯†ï¼Œsalté•¿åº¦16ä½
 * - å¤´åƒä¸Šä¼ åˆ°é˜¿é‡Œäº‘OSSï¼Œè·¯å¾„æ ¼å¼ä¸º/avatars/{userId}.jpg
 * - ä½¿ç”¨Redisç¼“å­˜ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ï¼ŒTTLä¸º1å°æ—¶
 * 
 * è¿™äº›å®ç°ç»†èŠ‚å¯¹æ¥å£ç”¨æˆ·æ²¡æœ‰ä»·å€¼ï¼Œåè€Œå¢åŠ äº†è®¤çŸ¥è´Ÿæ‹…
 */
public void saveUser(User user) {...}

// âœ… æ¥å£æ³¨é‡Šåªæè¿°æŠ½è±¡
/**
 * ä¿å­˜ç”¨æˆ·ä¿¡æ¯åˆ°ç³»ç»Ÿä¸­
 * 
 * è¿™ä¸ªæ–¹æ³•ä¼šå®Œæ•´ä¿å­˜ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯ï¼ŒåŒ…æ‹¬å¯†ç åŠ å¯†ã€å¤´åƒå­˜å‚¨ç­‰ã€‚
 * ä¿å­˜æˆåŠŸåç”¨æˆ·å¯ä»¥ç«‹å³ä½¿ç”¨æ–°ä¿¡æ¯ç™»å½•ç³»ç»Ÿã€‚
 * 
 * @param user ç”¨æˆ·ä¿¡æ¯å¯¹è±¡ï¼Œå¿…é¡»åŒ…å«ç”¨æˆ·åã€é‚®ç®±ã€å¯†ç 
 * @throws DuplicateUserException ç”¨æˆ·åæˆ–é‚®ç®±å·²å­˜åœ¨
 * @throws InvalidDataException ç”¨æˆ·ä¿¡æ¯æ ¼å¼ä¸æ­£ç¡®
 */
public void saveUser(User user) throws DuplicateUserException, InvalidDataException {...}
```

## âš™ï¸ 13.6 å®ç°æ³¨é‡Šï¼šwhatå’Œwhyï¼Œè€Œä¸æ˜¯how

### æ ¸å¿ƒç›®æ ‡

> "å®ç°æ³¨é‡Šçš„ä¸»è¦ç›®çš„æ˜¯å¸®åŠ©è¯»è€…ç†è§£ä»£ç åœ¨åšä»€ä¹ˆï¼ˆè€Œä¸æ˜¯ä»£ç å¦‚ä½•å·¥ä½œï¼‰ã€‚"

### ä¸‰ç§æœ‰æ•ˆçš„å®ç°æ³¨é‡Š

#### 1. ä¸»è¦ä»£ç å—å‰çš„æ³¨é‡Š
```java
public void processOrder(Order order) {
    // è®¢å•éªŒè¯ï¼šæ£€æŸ¥å•†å“åº“å­˜ã€ç”¨æˆ·æƒé™ã€æ”¯ä»˜ä¿¡æ¯
    // è¿™ä¸ªæ­¥éª¤ç¡®ä¿è®¢å•æ•°æ®çš„å®Œæ•´æ€§å’Œåˆæ³•æ€§
    validateOrder(order);
    
    // ä»·æ ¼è®¡ç®—ï¼šåº”ç”¨ä¼˜æƒ åˆ¸ã€è®¡ç®—ç¨è´¹ã€å¤„ç†æ±‡ç‡è½¬æ¢
    // æ”¯æŒå¤šç§ä¼˜æƒ ç­–ç•¥çš„ç»„åˆä½¿ç”¨
    calculateFinalPrice(order);
    
    // åº“å­˜é¢„å ï¼šé˜²æ­¢è¶…å–ï¼Œé¢„å æœŸé™30åˆ†é’Ÿ
    // ä½¿ç”¨æ‚²è§‚é”ç­–ç•¥ï¼Œç¡®ä¿é«˜å¹¶å‘ä¸‹çš„æ•°æ®ä¸€è‡´æ€§
    reserveInventory(order);
    
    // è®¢å•æŒä¹…åŒ–ï¼šä¿å­˜åˆ°æ•°æ®åº“ï¼Œç”Ÿæˆå”¯ä¸€è®¢å•å·
    // ä½¿ç”¨åˆ†å¸ƒå¼IDç”Ÿæˆå™¨ï¼Œç¡®ä¿å…¨å±€å”¯ä¸€æ€§
    saveOrder(order);
}
```

#### 2. å¾ªç¯æ³¨é‡Š
```java
// åˆ†æ‰¹å¤„ç†å¤§é‡æ•°æ®ï¼Œé¿å…å†…å­˜æº¢å‡º
// æ¯æ‰¹å¤„ç†1000æ¡è®°å½•ï¼Œå¤„ç†é—´éš”100msé˜²æ­¢CPUè¿‡è½½
for (int i = 0; i < totalRecords; i += BATCH_SIZE) {
    List<Record> batch = getRecordBatch(i, BATCH_SIZE);
    processBatch(batch);
    Thread.sleep(100); // ç»™ç³»ç»Ÿå–˜æ¯æ—¶é—´
}

// é‡è¯•æœºåˆ¶ï¼šç½‘ç»œè¯·æ±‚å¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•
// ä½¿ç”¨æŒ‡æ•°é€€é¿ç®—æ³•ï¼Œæœ€å¤§é‡è¯•3æ¬¡
int retryCount = 0;
while (retryCount < MAX_RETRIES) {
    try {
        result = remoteService.call(request);
        break; // æˆåŠŸåˆ™è·³å‡ºå¾ªç¯
    } catch (NetworkException e) {
        retryCount++;
        long delay = (long) (Math.pow(2, retryCount) * 1000); // æŒ‡æ•°é€€é¿
        Thread.sleep(delay);
    }
}
```

#### 3. è§£é‡Šä¸ºä»€ä¹ˆçš„æ³¨é‡Š
```java
// ä½¿ç”¨ConcurrentHashMapè€Œä¸æ˜¯HashMap
// åŸå› ï¼šè¿™ä¸ªç¼“å­˜ä¼šè¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®
// è™½ç„¶æ€§èƒ½ç¨å·®ï¼Œä½†é¿å…äº†å¹¶å‘ä¿®æ”¹å¼‚å¸¸
private Map<String, Object> cache = new ConcurrentHashMap<>();

// å¿…é¡»åœ¨äº‹åŠ¡æäº¤åå‘é€é‚®ä»¶
// å¦‚æœåœ¨äº‹åŠ¡å†…å‘é€ï¼Œäº‹åŠ¡å›æ»šæ—¶é‚®ä»¶å·²ç»å‘å‡ºï¼Œé€ æˆæ•°æ®ä¸ä¸€è‡´
transaction.commit();
emailService.sendOrderConfirmation(order);

// ä½¿ç”¨è½¯å¼•ç”¨ç¼“å­˜å›¾ç‰‡ï¼Œå…è®¸GCåœ¨å†…å­˜ä¸è¶³æ—¶å›æ”¶
// è¿™æ ·æ—¢æé«˜äº†æ€§èƒ½ï¼Œåˆé¿å…äº†å†…å­˜æ³„éœ²
private Map<String, SoftReference<BufferedImage>> imageCache = new HashMap<>();
```

### é¿å…çš„å®ç°æ³¨é‡Š

```java
// âŒ è§£é‡Šä»£ç å¦‚ä½•å·¥ä½œï¼ˆå¤ªä½çº§ï¼‰
// ä½¿ç”¨forå¾ªç¯éå†æ•°ç»„
for (int i = 0; i < items.length; i++) {
    // è·å–æ•°ç»„å…ƒç´ 
    Item item = items[i];
    // è°ƒç”¨å¤„ç†æ–¹æ³•
    processItem(item);
}

// âœ… è§£é‡Šä»£ç åœ¨åšä»€ä¹ˆï¼ˆåˆé€‚çš„çº§åˆ«ï¼‰
// é€ä¸ªå¤„ç†é˜Ÿåˆ—ä¸­çš„å¾…å¤„ç†é¡¹ç›®
// æŒ‰ç…§å…ˆè¿›å…ˆå‡ºçš„é¡ºåºä¿è¯å¤„ç†çš„å…¬å¹³æ€§
for (int i = 0; i < items.length; i++) {
    Item item = items[i];
    processItem(item);
}
```

## ğŸŒ 13.7 è·¨æ¨¡å—è®¾è®¡å†³ç­–ï¼šè§£å†³æ–‡æ¡£å½’å±éš¾é¢˜

### æŒ‘æˆ˜ï¼šæ–‡æ¡£æ”¾åœ¨å“ªé‡Œï¼Ÿ

è·¨æ¨¡å—çš„è®¾è®¡å†³ç­–å½±å“å¤šä¸ªç±»ï¼Œä½†å¾ˆéš¾æ‰¾åˆ°åˆé€‚çš„ä½ç½®æ”¾ç½®æ–‡æ¡£ã€‚ä¼ ç»Ÿçš„è§£å†³æ–¹æ¡ˆéƒ½æœ‰é—®é¢˜ï¼š

- æ”¾åœ¨æŸä¸ªç±»ä¸­ï¼šå…¶ä»–ç›¸å…³ç±»çš„å¼€å‘è€…å¯èƒ½çœ‹ä¸åˆ°
- æ”¾åœ¨å¤šä¸ªç±»ä¸­ï¼šå®¹æ˜“äº§ç”Ÿä¸ä¸€è‡´ï¼Œç»´æŠ¤å›°éš¾
- æ”¾åœ¨å¤–éƒ¨æ–‡æ¡£ï¼šå®¹æ˜“ä¸ä»£ç è„±èŠ‚ï¼Œè¿‡æ—¶åæ²¡äººæ›´æ–°

### è§£å†³æ–¹æ¡ˆï¼šdesignNotesä¸­å¤®æ–‡ä»¶

åŸæ–‡æå‡ºäº†ä¸€ä¸ªåˆ›æ–°çš„æ–¹æ³•ï¼šå°†è·¨æ¨¡å—é—®é¢˜è®°å½•åœ¨ä¸€ä¸ªåä¸ºdesignNotesçš„ä¸­å¤®æ–‡ä»¶ä¸­ã€‚

### å®é™…åº”ç”¨ç¤ºä¾‹

```java
/**
 * è·¨æ¨¡å—è®¾è®¡å†³ç­–ï¼šç”¨æˆ·çŠ¶æ€ä¸€è‡´æ€§ç­–ç•¥
 * 
 * é—®é¢˜èƒŒæ™¯ï¼š
 * ç”¨æˆ·ä¿¡æ¯åˆ†å¸ƒåœ¨å¤šä¸ªæ¨¡å—ä¸­ï¼ˆç”¨æˆ·æœåŠ¡ã€è®¢å•æœåŠ¡ã€ç§¯åˆ†æœåŠ¡ã€æ¨èæœåŠ¡ï¼‰
 * å¦‚ä½•ä¿è¯ç”¨æˆ·çŠ¶æ€åœ¨æ‰€æœ‰æ¨¡å—ä¸­çš„ä¸€è‡´æ€§ï¼Ÿ
 * 
 * è§£å†³æ–¹æ¡ˆï¼šäº‹ä»¶é©±åŠ¨çš„æœ€ç»ˆä¸€è‡´æ€§
 * 1. ç”¨æˆ·æœåŠ¡ä½œä¸ºä¸»æ•°æ®æºï¼Œå‘å¸ƒç”¨æˆ·çŠ¶æ€å˜æ›´äº‹ä»¶
 * 2. å…¶ä»–æœåŠ¡è®¢é˜…äº‹ä»¶ï¼Œå¼‚æ­¥æ›´æ–°æœ¬åœ°æ•°æ®
 * 3. ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ä¿è¯äº‹ä»¶ä¼ é€’çš„å¯é æ€§
 * 4. å®ç°è¡¥å¿æœºåˆ¶å¤„ç†å¼‚å¸¸æƒ…å†µ
 * 
 * è®¾è®¡æƒè¡¡ï¼š
 * - ä¼˜ç‚¹ï¼šå„æœåŠ¡è§£è€¦ï¼Œæ€§èƒ½å¥½ï¼Œæ‰©å±•æ€§å¼º
 * - ç¼ºç‚¹ï¼šæ•°æ®å¯èƒ½çŸ­æš‚ä¸ä¸€è‡´ï¼Œå¤æ‚æ€§å¢åŠ 
 * - ä¸šåŠ¡å¯æ¥å—æ€§ï¼šç”¨æˆ·ä¿¡æ¯å˜æ›´é¢‘ç‡ä½ï¼ŒçŸ­æš‚ä¸ä¸€è‡´å¯æ¥å—
 * 
 * å®ç°è¦ç‚¹ï¼š
 * - äº‹ä»¶æ ¼å¼ï¼šJSONæ ¼å¼ï¼ŒåŒ…å«ç”¨æˆ·IDã€å˜æ›´ç±»å‹ã€å˜æ›´å†…å®¹ã€æ—¶é—´æˆ³
 * - é‡è¯•ç­–ç•¥ï¼šå¤±è´¥é‡è¯•3æ¬¡ï¼ŒæŒ‡æ•°é€€é¿ï¼Œæœ€ç»ˆæ”¾å…¥æ­»ä¿¡é˜Ÿåˆ—
 * - ç›‘æ§å‘Šè­¦ï¼šäº‹ä»¶å¤„ç†å»¶è¿Ÿè¶…è¿‡5åˆ†é’Ÿæ—¶å‘Šè­¦
 * - æ•°æ®ä¿®å¤ï¼šå®šæœŸå…¨é‡åŒæ­¥ï¼Œä¿®å¤å¯èƒ½çš„æ•°æ®ä¸ä¸€è‡´
 * 
 * æ¶‰åŠæ¨¡å—ï¼šUserService, OrderService, PointService, RecommendationService, EventBus
 * 
 * æ›´æ–°è®°å½•ï¼š
 * - 2023-08-15: åˆå§‹è®¾è®¡ by å¼ ä¸‰
 * - 2023-09-20: å¢åŠ é‡è¯•æœºåˆ¶ by æå››
 * - 2023-10-10: æ·»åŠ ç›‘æ§å‘Šè­¦ by ç‹äº”
 */
```

### designNotesæ–‡ä»¶ç»“æ„å»ºè®®

```
designNotes/
â”œâ”€â”€ authentication.md          # è®¤è¯é‰´æƒç­–ç•¥
â”œâ”€â”€ data-consistency.md        # æ•°æ®ä¸€è‡´æ€§ç­–ç•¥
â”œâ”€â”€ error-handling.md          # é”™è¯¯å¤„ç†è§„èŒƒ
â”œâ”€â”€ performance-optimization.md # æ€§èƒ½ä¼˜åŒ–å†³ç­–
â”œâ”€â”€ security-considerations.md  # å®‰å…¨è€ƒè™‘
â”œâ”€â”€ deployment-strategy.md     # éƒ¨ç½²ç­–ç•¥
â””â”€â”€ monitoring-alerting.md     # ç›‘æ§å‘Šè­¦è§„èŒƒ
```

### designNotesçš„ä¼˜åŠ¿

1. **é›†ä¸­ç®¡ç†**ï¼šæ‰€æœ‰è·¨æ¨¡å—å†³ç­–é›†ä¸­åœ¨ä¸€ä¸ªåœ°æ–¹
2. **ç‰ˆæœ¬æ§åˆ¶**ï¼šè·Ÿéšä»£ç ä¸€èµ·è¿›è¡Œç‰ˆæœ¬ç®¡ç†
3. **æœç´¢å‹å¥½**ï¼šå¼€å‘è€…å®¹æ˜“æ‰¾åˆ°ç›¸å…³è®¾è®¡å†³ç­–
4. **ç»´æŠ¤æ€§å¥½**ï¼šä¿®æ”¹è®¾è®¡å†³ç­–æ—¶åªéœ€è¦æ›´æ–°ä¸€ä¸ªåœ°æ–¹
5. **çŸ¥è¯†ä¼ æ‰¿**ï¼šæ–°äººå¯ä»¥å¿«é€Ÿäº†è§£ç³»ç»Ÿçš„è®¾è®¡æ€è·¯

## ğŸ¯ æ€»ç»“ï¼šæ³¨é‡Šçš„æœ€ç»ˆç›®æ ‡

> "æ³¨é‡Šçš„ç›®çš„æ˜¯ç¡®ä¿ç³»ç»Ÿçš„ç»“æ„å’Œè¡Œä¸ºå¯¹è¯»è€…æ¥è¯´æ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œå› æ­¤ä»–ä»¬å¯ä»¥å¿«é€Ÿæ‰¾åˆ°æ‰€éœ€çš„ä¿¡æ¯ï¼Œå¹¶æœ‰ä¿¡å¿ƒå¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚"

### ä»è¯»è€…è§†è§’æ€è€ƒ

> "å½“éµå¾ªæ³¨é‡Šåº”æè¿°ä»£ç ä¸­ä¸æ˜æ˜¾çš„å†…å®¹çš„è§„åˆ™æ—¶ï¼Œ'æ˜æ˜¾'æ˜¯ä»ç¬¬ä¸€æ¬¡è¯»å–æ‚¨çš„ä»£ç çš„äººï¼ˆä¸æ˜¯æ‚¨ï¼‰çš„è§’åº¦å‡ºå‘ã€‚"

### æ³¨é‡Šçš„å±‚æ¬¡ç»“æ„

1. **ç±»çº§æ³¨é‡Š**ï¼šå®šä¹‰æŠ½è±¡ï¼Œè§£é‡Šç±»çš„ç”¨é€”å’Œè®¾è®¡ç†å¿µ
2. **æ–¹æ³•çº§æ³¨é‡Š**ï¼šæè¿°è¡Œä¸ºï¼Œè¯´æ˜å‚æ•°ã€è¿”å›å€¼ã€å¼‚å¸¸
3. **å˜é‡çº§æ³¨é‡Š**ï¼šå¢åŠ ç²¾åº¦ï¼Œæ¾„æ¸…å•ä½ã€è¾¹ç•Œã€çº¦æŸ
4. **å®ç°çº§æ³¨é‡Š**ï¼šè§£é‡Šå¤æ‚é€»è¾‘ï¼Œè¯´æ˜è®¾è®¡å†³ç­–
5. **è·¨æ¨¡å—æ³¨é‡Š**ï¼šå¤„ç†ç³»ç»Ÿçº§è®¾è®¡å†³ç­–

### ä¸å‰é¢ç« èŠ‚çš„å…³ç³»

- **ç¬¬2ç« ï¼ˆå¤æ‚æ€§ï¼‰**ï¼šæ³¨é‡Šé™ä½å¤æ‚æ€§ä¸­çš„"æ¨¡ç³Šæ€§"
- **ç¬¬4ç« ï¼ˆæ·±æ¨¡å—ï¼‰**ï¼šæ³¨é‡Šæ˜¯åˆ›å»ºç®€å•æ¥å£çš„å…³é”®å·¥å…·
- **ç¬¬5ç« ï¼ˆä¿¡æ¯éšè—ï¼‰**ï¼šæ³¨é‡Šæ­£ç¡®æš´éœ²æŠ½è±¡ï¼Œéšè—å®ç°ç»†èŠ‚
- **ç¬¬11ç« ï¼ˆè®¾è®¡ä¸¤æ¬¡ï¼‰**ï¼šæ³¨é‡Šæ˜¯è®¾è®¡æ€è€ƒçš„ä½“ç°
- **ç¬¬12ç« ï¼ˆæ³¨é‡Šä»·å€¼ï¼‰**ï¼šä»"ä¸ºä»€ä¹ˆå†™"åˆ°"æ€ä¹ˆå†™"çš„å®è·µè½¬æ¢

### å®ç”¨å»ºè®®

- **è¿›å…¥è¯»è€…å¿ƒæ€**ï¼šé—®è‡ªå·±"ä»–ä»¬éœ€è¦çŸ¥é“ä»€ä¹ˆå…³é”®ä¿¡æ¯ï¼Ÿ"
- **ä½¿ç”¨é»„é‡‘æµ‹è¯•**ï¼šä»æœªè§è¿‡ä»£ç çš„äººèƒ½å¦ä»…ä»ä»£ç å†™å‡ºè¿™ä¸ªæ³¨é‡Šï¼Ÿ
- **å…³æ³¨ä¸æ˜æ˜¾å†…å®¹**ï¼šåº•å±‚ç»†èŠ‚ã€è®¾è®¡åŸå› ã€éšå«è§„åˆ™
- **æŒç»­æ”¹è¿›**ï¼šåœ¨ä»£ç å®¡æŸ¥ä¸­é‡è§†æ³¨é‡Šè´¨é‡
- **å»ºç«‹çº¦å®š**ï¼šä¸ºå›¢é˜Ÿåˆ¶å®šæ¸…æ™°çš„æ³¨é‡Šè§„èŒƒ

### è¡ŒåŠ¨æŒ‡å—

1. **å»ºç«‹çº¦å®š**ï¼šä¸ºå›¢é˜Ÿåˆ¶å®šæ³¨é‡Šè§„èŒƒ
2. **ä¼˜å…ˆçº§æ’åº**ï¼šæ¥å£æ³¨é‡Š > æ•°æ®æˆå‘˜æ³¨é‡Š > å®ç°æ³¨é‡Š
3. **è´¨é‡æ£€æŸ¥**ï¼šä½¿ç”¨"è¯»è€…èƒ½å¦ä»…ä»ä»£ç å†™å‡ºæ³¨é‡Š"çš„æ ‡å‡†
4. **æŒç»­æ”¹è¿›**ï¼šåœ¨ä»£ç å®¡æŸ¥ä¸­é‡è§†æ³¨é‡Šè´¨é‡

---

> "å¥½çš„æ³¨é‡Šé€šå¸¸ä»¥ä¸ä»£ç ä¸åŒçš„è¯¦ç»†ç¨‹åº¦æ¥è§£é‡Šäº‹ç‰©ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹æ›´è¯¦ç»†ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹æ›´æŠ½è±¡ã€‚" â€”â€” John Ousterhout

**è®°ä½ï¼šæ³¨é‡Šä¸æ˜¯ä»£ç çš„æ³¨è„šï¼Œè€Œæ˜¯è®¾è®¡æ€ç»´çš„ä½“ç°ã€‚å®ƒä»¬è®©ä»£ç ä»æ­»çš„æ–‡æœ¬å˜æˆæ´»çš„çŸ¥è¯†ä¼ æ‰¿ï¼**